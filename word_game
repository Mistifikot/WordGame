<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å –ê–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å–∞</title>
<style>
  /* ========= –ë–ê–ó–ê ========= */
  * { margin:0; padding:0; box-sizing:border-box; }
  :root {
    --gold: #ffd700;
    --gold-dim: #ccaa00;
    --ink: #0a0806;
    --paper: #d4c4a0;
    --paper-dark: #b8a584;
    --border: #8b7355;
    --border-light: #a08060;
    --shadow: rgba(0,0,0,0.8);
    --glow-gold: rgba(255,215,0,0.3);
  }
  @font-face { font-family: 'BookTitle'; src: local('Palatino Linotype'), local('Book Antiqua'), local('Georgia'); font-weight: 700; }
  @font-face { font-family: 'BookText';  src: local('Georgia'), local('Palatino'), local('Times New Roman'); }
  body {
    font-family: 'BookText', Georgia, serif;
    background: var(--ink);
    color: var(--paper);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    user-select: none;
  }
  /* ========= –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù ========= */
  body::before {
    content: '';
    position: fixed; inset: 0; z-index: -2;
    background:
      radial-gradient(circle at 25% 30%, rgba(139,69,19,0.25) 0%, transparent 40%),
      radial-gradient(circle at 75% 70%, rgba(101,67,33,0.2) 0%, transparent 45%),
      radial-gradient(circle at 50% 50%, rgba(50,30,15,0.3) 0%, transparent 60%),
      linear-gradient(180deg, #1a1410 0%, #0a0806 50%, #050403 100%);
  }
  .ash-particle {
    position: fixed; width: 3px; height: 3px; background: rgba(255,215,0,0.3);
    border-radius: 50%; pointer-events: none; opacity: 0; animation: ashFloat 12s infinite;
  }
  @keyframes ashFloat { 0%{transform:translate(0,100vh) rotate(0);opacity:0} 10%{opacity:.8} 90%{opacity:.8} 100%{transform:translate(100px,-100vh) rotate(720deg);opacity:0} }
  .book-glow { position: fixed; width: 500px; height: 500px; background: radial-gradient(circle, rgba(255,200,100,0.08) 0%, transparent 60%); pointer-events:none; animation: bookPulse 4s ease-in-out infinite; z-index:-1; }
  @keyframes bookPulse { 0%,100%{opacity:.6;transform:scale(1)} 50%{opacity:1;transform:scale(1.1)} }

  /* ========= –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ========= */
  .main-menu { position:fixed; inset:0; z-index:5000; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(135deg,#0a0806 0%,#1a1410 100%); transition:opacity 1s ease; }
  .main-menu h1 {
    font-family:'BookTitle', Georgia, serif; font-size:4.5em; color:var(--gold);
    text-shadow:3px 3px 6px var(--shadow), 0 0 40px var(--glow-gold), 0 0 80px rgba(255,215,0,0.2);
    margin-bottom:20px; animation:titleFloat 3s ease-in-out infinite; letter-spacing:2px;
  }
  @keyframes titleFloat { 0%,100%{transform:translateY(0) scale(1)} 50%{transform:translateY(-10px) scale(1.02)} }
  .menu-subtitle { font-style:italic; color:var(--paper-dark); margin-bottom:50px; font-size:1.2em; opacity:.9; }
  .menu-buttons{ display:flex; flex-direction:column; gap:20px; }
  .menu-button{
    padding:18px 50px; min-width:320px; text-align:center; cursor:pointer;
    background:linear-gradient(135deg,#8b7355 0%,#6b5945 50%,#8b7355 100%); background-size:200% 100%;
    border:2px solid var(--gold); border-radius:10px; color:var(--gold); font-size:1.2em; font-family:'BookTitle', Georgia, serif; font-weight:700; letter-spacing:1px;
    transition:all .4s ease; text-shadow:2px 2px 4px rgba(0,0,0,0.5); position:relative; overflow:hidden;
  }
  .menu-button::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(255,215,0,0.2),transparent); transition:left .6s ease; }
  .menu-button:hover{ background-position:-100% 0; transform:translateY(-3px); box-shadow:0 10px 30px rgba(255,215,0,0.3), inset 0 0 20px rgba(255,215,0,0.1); }
  .menu-button:hover::before{ left:100% }

  /* ========= –ò–ì–†–û–í–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ========= */
  .game-container{ max-width:1700px; margin:0 auto; padding:25px; min-height:100vh; opacity:0; transition:opacity 1s ease; display:grid; gap:25px; grid-template-columns:320px 1fr 400px; }
  .game-container.visible{ opacity:1; }

  /* ========= –ü–ê–ù–ï–õ–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–ò ========= */
  .stats-panel{ display:flex; flex-direction:column; gap:20px; }
  .stats-box{
    background:linear-gradient(145deg,rgba(0,0,0,0.85),rgba(30,20,10,0.75)); border:2px solid var(--border); border-radius:15px; padding:25px;
    box-shadow: inset 0 2px 10px rgba(255,215,0,0.05), inset 0 -2px 10px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.8);
    position:relative; overflow:hidden;
  }
  .stats-box::before{ content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:radial-gradient(circle,rgba(255,215,0,0.03) 0%, transparent 70%); animation:rotateGlow 20s linear infinite; }
  @keyframes rotateGlow{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
  .stats-box h2{ font-family:'BookTitle', Georgia, serif; font-weight:700; color:var(--gold); margin-bottom:25px; text-align:center; font-size:1.3em; text-shadow:2px 2px 4px var(--shadow), 0 0 15px var(--glow-gold); letter-spacing:1px; position:relative; }
  .stat{ margin-bottom:20px; position:relative; }
  .stat-label{ display:flex; justify-content:space-between; margin-bottom:10px; font-size:.95em; font-weight:600; }
  .stat-value{ font-weight:700; color:var(--gold); text-shadow:0 0 5px var(--glow-gold); font-size:1.1em; }
  .stat-bar{ background:linear-gradient(to bottom,#0a0806,#1a1410); height:26px; border-radius:13px; overflow:hidden; border:1px solid #3a3025; box-shadow: inset 0 2px 6px rgba(0,0,0,0.7), 0 1px 2px rgba(255,215,0,0.1); position:relative; }
  .stat-fill{ height:100%; transition:width .8s cubic-bezier(.4,0,.2,1); border-radius:13px; position:relative; overflow:hidden; }
  .stat-fill::after{ content:''; position:absolute; inset:0; background:linear-gradient(90deg,transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%); animation:shimmer 2.5s infinite; }
  @keyframes shimmer{ 0%{transform:translateX(-100%) skewX(-15deg)} 100%{transform:translateX(200%) skewX(-15deg)} }
  .stat.warning .stat-bar{ animation: warningPulse 1s infinite; box-shadow: inset 0 2px 6px rgba(0,0,0,0.7), 0 0 15px rgba(255,0,0,0.4); }
  .stat.critical .stat-value{ color:#ff4444; animation: criticalBlink .5s infinite; }
  @keyframes criticalBlink{ 0%,100%{opacity:1} 50%{opacity:.5} }
  @keyframes warningPulse{ 0%,100%{border-color:#8b4513} 50%{border-color:#ff6b6b} }
  .stat-health .stat-fill{ background:linear-gradient(90deg,#4a0e0e,#8b0000,#dc143c,#ff6b6b) }
  .stat-food   .stat-fill{ background:linear-gradient(90deg,#4a3a0a,#8b6914,#daa520,#ffdb58) }
  .stat-safety .stat-fill{ background:linear-gradient(90deg,#2a0a4a,#4b0082,#8a2be2,#b19cd9) }
  .stat-morale .stat-fill{ background:linear-gradient(90deg,#0a3a0a,#006400,#32cd32,#90ee90) }
  .stat-trust  .stat-fill{ background:linear-gradient(90deg,#0a0a3a,#191970,#4169e1,#6495ed) }

  .journal-box{ background:linear-gradient(145deg,rgba(0,0,0,0.85),rgba(30,20,10,0.75)); border:2px solid var(--border); border-radius:15px; padding:20px; max-height:350px; overflow-y:auto; box-shadow: inset 0 2px 10px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.8); }
  .journal-box h3{ font-family:'BookTitle', Georgia, serif; font-weight:700; color:var(--gold); margin-bottom:15px; font-size:1.1em; text-shadow:0 0 10px var(--glow-gold); }
  .journal-entry{ font-size:.9em; margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid rgba(139,115,85,0.3); font-style:italic; color:var(--paper-dark); animation: fadeIn .5s ease; line-height:1.4; }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:translateY(0)} }

  /* ========= –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ ========= */
  .main-area{ display:flex; flex-direction:column; gap:25px; }
  .day-info{ background:linear-gradient(145deg,rgba(0,0,0,0.85),rgba(40,30,15,0.75)); border:2px solid var(--border); border-radius:20px; padding:30px; text-align:center; position:relative; overflow:hidden; box-shadow: inset 0 2px 15px rgba(255,215,0,0.1), 0 5px 30px rgba(0,0,0,0.8); }
  .day-info::before{ content:''; position:absolute; top:-100%; left:-100%; width:300%; height:300%; background:radial-gradient(circle,rgba(255,215,0,0.05) 0%, transparent 60%); animation:rotate 30s linear infinite; }
  @keyframes rotate{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
  .day-info h1{ font-family:'BookTitle', Georgia, serif; font-weight:700; font-size:2.8em; color:var(--gold); text-shadow:3px 3px 6px var(--shadow), 0 0 20px var(--glow-gold); margin-bottom:15px; position:relative; letter-spacing:2px; }
  .day-description{ font-size:1.2em; color:var(--paper); font-style:italic; position:relative; opacity:.9; }

  .visitor-area{
    background:linear-gradient(145deg,rgba(0,0,0,0.85),rgba(30,20,10,0.75)); border:2px solid var(--border); border-radius:20px; padding:40px; min-height:450px;
    display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; box-shadow: inset 0 0 60px rgba(0,0,0,0.5), 0 5px 35px rgba(0,0,0,0.8);
  }
  .visitors-queue{ position:absolute; top:15px; right:15px; display:flex; gap:8px; }
  .queue-indicator{ width:12px; height:12px; border-radius:50%; background:var(--border); transition:all .3s ease; }
  .queue-indicator.active{ background:var(--gold); box-shadow:0 0 10px var(--glow-gold); animation:queuePulse 1s infinite; }
  @keyframes queuePulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.2)} }
  .visitor{ text-align:center; animation: fadeIn .8s ease; max-width:500px; }
  .visitor-portrait{
    width:160px; height:160px; border-radius:50%; margin:0 auto 25px; display:flex; align-items:center; justify-content:center; border:3px solid var(--border);
    background: radial-gradient(circle, #2a1810, #1a0f08); font-size:4.5em; cursor:pointer; transition:all .3s ease; box-shadow:0 5px 20px rgba(0,0,0,0.6), inset 0 0 30px rgba(0,0,0,0.4); position:relative;
  }
  .visitor-portrait::after{ content:''; position:absolute; inset:-8px; border-radius:50%; background:radial-gradient(circle,transparent 60%, rgba(255,215,0,0.1) 100%); opacity:0; transition:opacity .3s ease; }
  .visitor-portrait:hover{ transform:scale(1.08); box-shadow:0 8px 30px rgba(139,115,85,0.5), inset 0 0 40px rgba(255,215,0,0.1); }
  .visitor-portrait:hover::after{ opacity:1; }
  .visitor-portrait.selected{ border-color:var(--gold); box-shadow:0 0 40px var(--glow-gold), inset 0 0 30px rgba(255,215,0,0.2); animation:selectedGlow 2s ease-in-out infinite; }
  @keyframes selectedGlow{ 0%,100%{ transform:scale(1); filter:brightness(1)} 50%{ transform:scale(1.05); filter:brightness(1.2)} }
  .visitor-name{ font-family:'BookTitle', Georgia, serif; font-weight:700; font-size:1.5em; color:#e8d7c3; margin-bottom:20px; text-shadow:2px 2px 4px var(--shadow); letter-spacing:1px; }
  .visitor-problem{
    background: linear-gradient(135deg, rgba(139,115,85,0.15), rgba(100,80,60,0.1));
    border:1px solid rgba(139,115,85,0.5); border-radius:12px; padding:20px; margin:15px 0; font-style:italic; line-height:1.6; font-size:1.1em;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.3), 0 2px 10px rgba(0,0,0,0.2);
  }
  .problem-keyword{ color:var(--gold); font-weight:700; font-style:normal; text-transform:uppercase; letter-spacing:1px; text-shadow:0 0 12px var(--glow-gold); animation:keywordPulse 2s ease-in-out infinite; }
  @keyframes keywordPulse{ 0%,100%{ filter:brightness(1)} 50%{ filter:brightness(1.3)} }

  /* ========= –ö–ù–ò–ì–ê –°–õ–û–í ========= */
  .word-book{
    background:linear-gradient(145deg,rgba(0,0,0,0.85),rgba(40,30,15,0.75)); border:2px solid var(--border); border-radius:20px; padding:25px; display:flex; flex-direction:column;
    max-height:calc(100vh - 50px); box-shadow: inset 0 2px 15px rgba(255,215,0,0.05), 0 5px 35px rgba(0,0,0,0.8); position:relative; overflow:hidden;
  }
  .word-book::before{ content:''; position:absolute; top:-50%; right:-50%; width:200%; height:200%; background:radial-gradient(circle,rgba(255,215,0,0.02) 0%, transparent 60%); animation: rotate 40s linear infinite reverse; }
  .word-book h2{ font-family:'BookTitle', Georgia, serif; font-weight:700; color:var(--gold); margin-bottom:15px; text-align:center; font-size:1.6em; text-shadow:2px 2px 4px var(--shadow), 0 0 20px var(--glow-gold); letter-spacing:2px; position:relative; }
  .word-count{ text-align:center; color:var(--paper-dark); font-size:.95em; margin-bottom:15px; font-weight:600; position:relative; }
  .word-search{
    margin-bottom:20px; padding:12px 16px; background: rgba(0,0,0,0.5); border:1px solid var(--border); border-radius:8px; color:var(--paper); font-family:'BookText', Georgia, serif; font-size:1em; transition:all .3s ease; position:relative;
  }
  .word-search:focus{ outline:none; border-color:var(--gold-dim); box-shadow:0 0 10px rgba(255,215,0,0.2); }
  .word-categories{ display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; position:relative; }
  .category-tab{
    padding:8px 14px; background:linear-gradient(135deg, rgba(139,115,85,0.2), rgba(100,80,60,0.15)); border:1px solid var(--border); border-radius:8px; cursor:pointer; font-size:.9em; font-weight:600; transition:all .3s ease; position:relative; letter-spacing:.5px;
  }
  .category-tab.active{ background:linear-gradient(135deg, rgba(139,115,85,0.5), rgba(100,80,60,0.4)); color:var(--gold); box-shadow:0 0 15px rgba(255,215,0,0.3), inset 0 1px 3px rgba(255,215,0,0.1); }
  .category-tab:hover:not(.active){ background:linear-gradient(135deg, rgba(139,115,85,0.35), rgba(100,80,60,0.25)); transform:translateY(-2px); }
  .category-count{ position:absolute; top:-6px; right:-6px; background:var(--gold); color:var(--ink); border-radius:50%; width:18px; height:18px; font-size:.75em; font-weight:700; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 5px rgba(0,0,0,0.3); }

  .words-container{ flex:1; overflow-y:auto; padding:20px; background:linear-gradient(135deg, rgba(0,0,0,0.3), rgba(20,15,10,0.2)); border-radius:12px; margin-bottom:20px; position:relative; }
  .words-container::-webkit-scrollbar{ width:10px; } .words-container::-webkit-scrollbar-track{ background:rgba(0,0,0,0.3); border-radius:5px; }
  .words-container::-webkit-scrollbar-thumb{ background:var(--border); border-radius:5px; } .words-container::-webkit-scrollbar-thumb:hover{ background:var(--border-light); }

  .word{
    display:inline-block; padding:12px 18px; margin:8px; background:linear-gradient(135deg, rgba(139,115,85,0.35), rgba(100,80,60,0.3));
    border:1px solid var(--border); border-radius:8px; cursor:grab; transition:all .25s ease; position:relative; font-size:1.05em; font-weight:600; letter-spacing:.5px;
    box-shadow:0 2px 8px rgba(0,0,0,0.3), inset 0 1px 2px rgba(255,215,0,0.05);
  }
  .word:active{ cursor:grabbing; }
  .word:hover:not(.used){ background:linear-gradient(135deg, rgba(139,115,85,0.5), rgba(100,80,60,0.45)); transform:translateY(-4px) scale(1.05); box-shadow:0 6px 20px rgba(0,0,0,0.5), 0 0 15px rgba(255,215,0,0.2), inset 0 1px 3px rgba(255,215,0,0.1); }
  .word.used{ opacity:.3; text-decoration:line-through; cursor:not-allowed; background:rgba(50,50,50,0.3); box-shadow:none; }
  .word.selected{ background:linear-gradient(135deg, rgba(255,215,0,0.35), rgba(255,200,0,0.25)); border-color:var(--gold); box-shadow:0 0 20px var(--glow-gold), inset 0 0 10px rgba(255,215,0,0.2); transform:translateY(-4px) scale(1.08); animation:selectedWordPulse 1s ease-in-out infinite; }
  @keyframes selectedWordPulse{ 0%,100%{ filter:brightness(1)} 50%{ filter:brightness(1.2)} }
  .word.neologism{ background:linear-gradient(135deg, rgba(150,100,200,0.35), rgba(100,50,150,0.3)); border-color:#9966ff; }
  .word-tooltip{
    position:absolute; bottom:calc(100% + 8px); left:50%; transform:translateX(-50%);
    background:rgba(0,0,0,0.95); border:1px solid var(--border); padding:10px 14px; border-radius:8px; font-size:.9em; white-space:nowrap; pointer-events:none; opacity:0; transition:opacity .3s ease; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.5);
  }
  .word:hover .word-tooltip{ opacity:1 }

  /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
  .action-buttons{ display:flex; gap:12px; position:relative; }
  .action-button{
    flex:1; padding:14px 24px; background:linear-gradient(135deg,#8b7355 0%, #6b5945 50%, #8b7355 100%); background-size:200% 100%;
    border:2px solid var(--gold); border-radius:10px; color:var(--gold); font-family:'BookTitle', Georgia, serif; font-weight:700; font-size:1.05em; cursor:pointer; transition:all .3s ease; text-shadow:2px 2px 4px rgba(0,0,0,0.5); position:relative; letter-spacing:.5px; overflow:hidden;
  }
  .action-button::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent, rgba(255,215,0,0.3), transparent); transition:left .6s ease; }
  .action-button:hover:not(:disabled){ background-position:-100% 0; box-shadow:0 0 25px var(--glow-gold), inset 0 0 15px rgba(255,215,0,0.1); transform:translateY(-2px); }
  .action-button:hover:not(:disabled)::before{ left:100% }
  .action-button:disabled{ opacity:.4; cursor:not-allowed; border-color:#666; color:#999; background:linear-gradient(135deg,#4a4a4a,#3a3a3a) }
  .neologism-count{
    position:absolute; top:-10px; right:-10px; background:var(--gold); color:var(--ink); border-radius:50%; width:22px; height:22px; font-size:.85em; font-weight:700; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 8px rgba(0,0,0,0.4);
  }

  /* ========= –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========= */
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,0.92); display:flex; align-items:center; justify-content:center; z-index:4000; animation: fadeIn .3s ease; backdrop-filter: blur(5px); }
  .modal-content{
    background:linear-gradient(145deg,#1a1410,#2a2010); border:2px solid var(--gold); border-radius:20px; padding:35px; max-width:750px; max-height:85vh; overflow-y:auto; text-align:center;
    box-shadow:0 10px 50px rgba(0,0,0,0.8), 0 0 40px var(--glow-gold); animation: modalSlide .4s ease;
  }
  @keyframes modalSlide{ from{opacity:0; transform:translateY(-30px)} to{opacity:1; transform:translateY(0)} }
  .modal-content h3{ font-family:'BookTitle', Georgia, serif; font-weight:700; color:var(--gold); margin-bottom:20px; font-size:1.5em; text-shadow:0 0 15px var(--glow-gold); letter-spacing:1px; }

  /* –í—ã–±–æ—Ä —Å–ª–æ–≤ –≤ –º–æ–¥–∞–ª–∫–∞—Ö (discovery / neologism) */
  .word-selector{ display:grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:10px; margin:15px 0 10px; max-height:260px; overflow:auto; padding:10px; background:rgba(0,0,0,0.25); border-radius:10px; }
  .word-option{
    padding:10px 12px; border:1px solid var(--border); border-radius:8px; cursor:pointer;
    background:linear-gradient(135deg, rgba(139,115,85,0.25), rgba(100,80,60,0.2)); transition: all .25s ease; font-weight:600;
  }
  .word-option:hover{ transform: translateY(-2px); background:linear-gradient(135deg, rgba(139,115,85,0.4), rgba(100,80,60,0.35)); }
  .word-option.selected{ border-color: var(--gold); box-shadow: 0 0 14px var(--glow-gold); background:linear-gradient(135deg, rgba(255,215,0,0.25), rgba(255,200,0,0.2)); }

  /* ========= –†–ï–ó–£–õ–¨–¢–ê–¢–´ ========= */
  .result-message{
    position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); z-index:3500;
    background:linear-gradient(145deg, rgba(0,0,0,0.96), rgba(40,30,15,0.96)); border:2px solid var(--gold); border-radius:20px; padding:30px; max-width:650px; text-align:center;
    animation: resultAppear .5s ease; box-shadow:0 10px 50px rgba(0,0,0,0.8), 0 0 30px var(--glow-gold);
  }
  @keyframes resultAppear{ from{opacity:0; transform:translate(-50%, -50%) scale(.85)} to{opacity:1; transform:translate(-50%, -50%) scale(1)} }
  .stat-changes{ margin-top:20px; display:flex; justify-content:center; gap:20px; flex-wrap:wrap; }
  .stat-change{ font-size:1.1em; font-weight:700; padding:5px 10px; border-radius:5px; animation: statPop .5s ease; }
  @keyframes statPop{ from{ transform:scale(0) } to{ transform:scale(1) } }
  .positive{ color:#4ade80; text-shadow:0 0 10px rgba(74,222,128,0.5); background:rgba(74,222,128,0.1); }
  .negative{ color:#ff6b6b; text-shadow:0 0 10px rgba(255,107,107,0.5); background:rgba(255,107,107,0.1); }

  .word-effect{
    position:fixed; font-family:'BookTitle', Georgia, serif; font-weight:700; font-size:3em; color:var(--gold); pointer-events:none; z-index:3400;
    text-shadow:0 0 20px var(--glow-gold), 0 0 40px rgba(255,215,0,0.5); animation: wordDisappear 3s ease forwards; left:50%; top:50%; letter-spacing:2px;
  }
  @keyframes wordDisappear{ 0%{opacity:1; transform:translate(-50%,-50%) scale(1) rotate(0); filter:blur(0)} 50%{opacity:1; transform:translate(-50%,-80%) scale(1.2) rotate(5deg); filter:blur(0)} 100%{opacity:0; transform:translate(-50%,-200%) scale(.3) rotate(15deg); filter:blur(10px)} }

  /* ========= –ö–û–ù–ï–¶ –ò–ì–†–´ ========= */
  .game-over{ position:fixed; inset:0; background:rgba(0,0,0,0.98); display:flex; align-items:center; justify-content:center; z-index:3000; animation: fadeIn 1s ease; backdrop-filter: blur(10px); }
  .game-over-content{ text-align:center; max-width:750px; padding:50px; }
  .game-over h1{ font-family:'BookTitle', Georgia, serif; font-weight:700; font-size:4em; margin-bottom:30px; text-shadow:0 0 40px currentColor; letter-spacing:3px; }
  .victory{ color:#4ade80 } .defeat{ color:#ff6b6b } .neutral{ color:var(--gold) }

  /* –°–ø–µ—Ü-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
  .event-notification{
    position:fixed; top:50px; left:50%; transform:translateX(-50%);
    background:linear-gradient(145deg, rgba(40,30,15,0.98), rgba(0,0,0,0.98)); border:2px solid var(--gold); border-radius:15px; padding:20px 30px; color:var(--paper);
    font-size:1.1em; font-weight:600; z-index:3600; animation:eventSlide .5s ease; box-shadow:0 10px 40px rgba(0,0,0,0.8), 0 0 30px var(--glow-gold);
  }
  @keyframes eventSlide{ from{ opacity:0; transform:translateX(-50%) translateY(-20px)} to{ opacity:1; transform:translateX(-50%) translateY(0)} }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
  @media (max-width: 1400px){
    .game-container{ grid-template-columns:1fr; max-width:900px; }
    .stats-panel{ display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    .word-book{ max-height:500px; }
  }
</style>
</head>
<body>

<!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
<div class="main-menu" id="main-menu">
  <h1>–ë–ò–ë–õ–ò–û–¢–ï–ö–ê–†–¨ –ê–ü–û–ö–ê–õ–ò–ü–°–ò–°–ê</h1>
  <p class="menu-subtitle">–ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –≤–µ—Å –∑–æ–ª–æ—Ç–∞...</p>
  <div class="menu-buttons">
    <button class="menu-button" id="continue-btn" style="display:none" onclick="continueGame()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
    <button class="menu-button" onclick="startCampaign()">–ù–û–í–ê–Ø –ö–ê–ú–ü–ê–ù–ò–Ø</button>
    <button class="menu-button" onclick="startRoguelike()">–í–´–ñ–ò–í–ê–ù–ò–ï</button>
  </div>
</div>

<!-- –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–≤–µ—á–µ–Ω–∏—è -->
<div class="book-glow" style="top: 10%; left: 5%;"></div>
<div class="book-glow" style="top: 60%; right: 10%;"></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<div class="game-container" id="game-container">
  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="stats-panel">
    <div class="stats-box">
      <h2>‚öúÔ∏è –ü–û–°–ï–õ–ï–ù–ò–ï ‚öúÔ∏è</h2>
      <div class="stat stat-health" data-stat="health">
        <div class="stat-label"><span>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</span><span class="stat-value" id="health-value">65</span></div>
        <div class="stat-bar"><div class="stat-fill" style="width:65%"></div></div>
      </div>
      <div class="stat stat-food" data-stat="food">
        <div class="stat-label"><span>üåæ –ü—Ä–æ–≤–∏–∞–Ω—Ç</span><span class="stat-value" id="food-value">55</span></div>
        <div class="stat-bar"><div class="stat-fill" style="width:55%"></div></div>
      </div>
      <div class="stat stat-safety" data-stat="safety">
        <div class="stat-label"><span>üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</span><span class="stat-value" id="safety-value">45</span></div>
        <div class="stat-bar"><div class="stat-fill" style="width:45%"></div></div>
      </div>
      <div class="stat stat-morale" data-stat="morale">
        <div class="stat-label"><span>üíö –ú–æ—Ä–∞–ª—å</span><span class="stat-value" id="morale-value">50</span></div>
        <div class="stat-bar"><div class="stat-fill" style="width:50%"></div></div>
      </div>
      <div class="stat stat-trust" data-stat="trust">
        <div class="stat-label"><span>ü§ù –î–æ–≤–µ—Ä–∏–µ</span><span class="stat-value" id="trust-value">45</span></div>
        <div class="stat-bar"><div class="stat-fill" style="width:45%"></div></div>
      </div>
    </div>
    <div class="journal-box">
      <h3>üìú –î–ù–ï–í–ù–ò–ö</h3>
      <div id="journal-content">
        <div class="journal-entry">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è —Å—Ç—Ä–∞–∂–¥—É—â–∏—Ö...</div>
      </div>
    </div>
  </div>

  <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
  <div class="main-area">
    <div class="day-info">
      <h1>–î–ï–ù–¨ <span id="day-number">1</span></h1>
      <p class="day-description" id="day-description">–ù–∞—á–∞–ª–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π...</p>
    </div>

    <div class="visitor-area">
      <div class="visitors-queue" id="visitors-queue"></div>
      <div id="visitor-content"></div>
    </div>

    <button class="action-button" id="next-day-btn" style="display:none" onclick="nextDay()">–ó–ê–í–ï–†–®–ò–¢–¨ –î–ï–ù–¨</button>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
  <div class="word-book">
    <h2>üìñ –ö–ù–ò–ì–ê –°–õ–û–í</h2>
    <div class="word-count" id="word-count">–î–æ—Å—Ç—É–ø–Ω–æ: 0</div>
    <input type="text" class="word-search" placeholder="–ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞..." id="word-search">
    <div class="word-categories" id="word-categories"></div>
    <div class="words-container" id="words-container"></div>
    <div class="action-buttons">
      <button class="action-button" id="give-word-btn" onclick="giveWord()" disabled>–û–¢–î–ê–¢–¨ –°–õ–û–í–û</button>
      <button class="action-button" id="create-word-btn" onclick="openNeologismModal()">–°–û–ó–î–ê–¢–¨ <span class="neologism-count" id="neo-count">2</span></button>
    </div>
  </div>
</div>

<script>
/* ===================== –ö–û–ù–§–ò–ì / –°–û–°–¢–û–Ø–ù–ò–ï ===================== */
const CATEGORIES = ['all','medicine','emotion','nature','resource','social','abstract'];
const CATEGORY_NAMES = { all:'–í–°–ï', medicine:'–ú–ï–î–ò–¶–ò–ù–ê', emotion:'–≠–ú–û–¶–ò–ò', nature:'–ü–†–ò–†–û–î–ê', resource:'–†–ï–°–£–†–°–´', social:'–û–ë–©–ï–°–¢–í–û', abstract:'–ê–ë–°–¢–†–ê–ö–¢' };

const DEFAULT_STATS = { health:65, food:55, safety:45, morale:50, trust:45 };

let gameState = {
  mode:'campaign',
  day:1,
  stats:{...DEFAULT_STATS},
  currentVisitor:null,
  selectedWord:null,
  visitorsQueue:[],
  usedWords:new Set(),
  journal:[],
  canCreateNeologism:2,
  discoveredWords:[],
  roguelikeScore:0,
  ended:false,
  nightDecay:2,
  currentAct:null,
  actsEntered:new Set(),
  lastBeat:null,
  crisisFlags:{ epidemic:false, famine:false, unrest:false },
  wordsUsedToday:[],
  snapshot:{}
};

/* ===================== –ë–ê–ó–ê –°–õ–û–í ===================== */
const wordsDatabase = [
  { text:"–õ–µ–∫–∞—Ä—Å—Ç–≤–æ", category:"medicine", id:"med1", tooltip:"–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ" },
  { text:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ", category:"medicine", id:"med2", tooltip:"–ú–∞–≥–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ" },
  { text:"–¢—Ä–∞–≤—ã", category:"medicine", id:"med3", tooltip:"–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞" },
  { text:"–ü–µ—Ä–µ–≤—è–∑–∫–∞", category:"medicine", id:"med4", tooltip:"–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—Ä–æ–≤–∏" },
  { text:"–ê–Ω—Ç–∏–¥–æ—Ç", category:"medicine", id:"med5", tooltip:"–ü—Ä–æ—Ç–∏–≤–æ—è–¥–∏–µ" },
  { text:"–ö–∞—Ä–∞–Ω—Ç–∏–Ω", category:"medicine", id:"med6", tooltip:"–ò–∑–æ–ª—è—Ü–∏—è –±–æ–ª—å–Ω—ã—Ö" },

  { text:"–ú—É–∂–µ—Å—Ç–≤–æ", category:"emotion", id:"emo1", tooltip:"–•—Ä–∞–±—Ä–æ—Å—Ç—å" },
  { text:"–ù–∞–¥–µ–∂–¥–∞", category:"emotion", id:"emo2", tooltip:"–í–µ—Ä–∞ –≤ –ª—É—á—à–µ–µ" },
  { text:"–ü–æ–∫–æ–π", category:"emotion", id:"emo3", tooltip:"–£–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ" },
  { text:"–ì–Ω–µ–≤", category:"emotion", id:"emo4", tooltip:"–Ø—Ä–æ—Å—Ç—å" },
  { text:"–†–∞–¥–æ—Å—Ç—å", category:"emotion", id:"emo5", tooltip:"–°—á–∞—Å—Ç—å–µ" },
  { text:"–õ—é–±–æ–≤—å", category:"emotion", id:"emo6", tooltip:"–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å" },
  { text:"–°—Ç—Ä–∞—Ö", category:"emotion", id:"emo7", tooltip:"–£–∂–∞—Å" },
  { text:"–û—Ç—á–∞—è–Ω–∏–µ", category:"emotion", id:"emo8", tooltip:"–ë–µ–∑–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å" },

  { text:"–î–æ–∂–¥—å", category:"nature", id:"nat1", tooltip:"–í–æ–¥–∞ —Å –Ω–µ–±–µ—Å" },
  { text:"–û–≥–æ–Ω—å", category:"nature", id:"nat2", tooltip:"–ü–ª–∞–º—è" },
  { text:"–í–æ–¥–∞", category:"nature", id:"nat3", tooltip:"–ò—Å—Ç–æ—á–Ω–∏–∫ –∂–∏–∑–Ω–∏" },
  { text:"–í–µ—Ç–µ—Ä", category:"nature", id:"nat4", tooltip:"–î–≤–∏–∂–µ–Ω–∏–µ –≤–æ–∑–¥—É—Ö–∞" },
  { text:"–°–æ–ª–Ω—Ü–µ", category:"nature", id:"nat5", tooltip:"–°–≤–µ—Ç –∏ —Ç–µ–ø–ª–æ" },
  { text:"–ó–µ–º–ª—è", category:"nature", id:"nat6", tooltip:"–ü–æ—á–≤–∞" },
  { text:"–õ—ë–¥", category:"nature", id:"nat7", tooltip:"–•–æ–ª–æ–¥" },
  { text:"–¢—É–º–∞–Ω", category:"nature", id:"nat8", tooltip:"–°–æ–∫—Ä—ã—Ç–∏–µ" },

  { text:"–•–ª–µ–±", category:"resource", id:"res1", tooltip:"–û—Å–Ω–æ–≤–Ω–∞—è –ø–∏—â–∞" },
  { text:"–ó–µ—Ä–Ω–æ", category:"resource", id:"res2", tooltip:"–°–µ–º–µ–Ω–∞" },
  { text:"–£—Ä–æ–∂–∞–π", category:"resource", id:"res3", tooltip:"–ü–ª–æ–¥—ã —Ç—Ä—É–¥–∞" },
  { text:"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", category:"resource", id:"res4", tooltip:"–û—Ä—É–¥–∏—è" },
  { text:"–£–±–µ–∂–∏—â–µ", category:"resource", id:"res5", tooltip:"–ó–∞—â–∏—Ç–∞" },
  { text:"–û—Ä—É–∂–∏–µ", category:"resource", id:"res6", tooltip:"–°—Ä–µ–¥—Å—Ç–≤–æ –æ–±–æ—Ä–æ–Ω—ã" },

  { text:"–ú–∏—Ä", category:"social", id:"soc1", tooltip:"–°–æ–≥–ª–∞—Å–∏–µ" },
  { text:"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", category:"social", id:"soc2", tooltip:"–ß–µ—Å—Ç–Ω–æ—Å—Ç—å" },
  { text:"–ó–∞–∫–æ–Ω", category:"social", id:"soc3", tooltip:"–ü–æ—Ä—è–¥–æ–∫" },
  { text:"–ï–¥–∏–Ω—Å—Ç–≤–æ", category:"social", id:"soc4", tooltip:"–°–ø–ª–æ—á–µ–Ω–Ω–æ—Å—Ç—å" },
  { text:"–ó–Ω–∞–Ω–∏–µ", category:"social", id:"soc5", tooltip:"–ú—É–¥—Ä–æ—Å—Ç—å" },
  { text:"–ü—Ä–∞–≤–¥–∞", category:"social", id:"soc6", tooltip:"–ò—Å—Ç–∏–Ω–∞" },

  { text:"–í—Ä–µ–º—è", category:"abstract", id:"abs1", tooltip:"–¢–µ—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π" },
  { text:"–¢–∏—à–∏–Ω–∞", category:"abstract", id:"abs2", tooltip:"–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–≤—É–∫–∞" },
  { text:"–°–≤–µ—Ç", category:"abstract", id:"abs3", tooltip:"–°–∏—è–Ω–∏–µ" },
  { text:"–°—É–¥—å–±–∞", category:"abstract", id:"abs4", tooltip:"–ü—Ä–µ–¥–Ω–∞—á–µ—Ä—Ç–∞–Ω–∏–µ" },
  { text:"–ü–∞–º—è—Ç—å", category:"abstract", id:"abs5", tooltip:"–í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è" }
];

/* ===================== –ö–ê–ú–ü–ê–ù–ò–Ø / –°–û–ë–´–¢–ò–Ø ===================== */
const CAMPAIGN_ACTS = [
  {
    id:"I",
    label:"–ê–∫—Ç I",
    title:"–¢–ª–µ—é—â–∏–µ –Ω–∞–¥–µ–∂–¥—ã",
    start:1,
    end:16,
    nightDecay:2,
    entryText:"–ê–∫—Ç I. –¢–ª–µ—é—â–∏–µ –Ω–∞–¥–µ–∂–¥—ã: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–Ω–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–æ—Å–∏—Ç–µ–ª–µ–π.",
    entryModifiers:{ morale:5, trust:5 },
    beats:[
      "–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–µ –æ—Å–∫–æ–ª–∫–∏ –±—ã–ª–æ–π —Ä–µ—á–∏.",
      "–ñ–∏—Ç–µ–ª–∏ —É—á–∞—Ç—Å—è –¥–æ–≤–µ—Ä—è—Ç—å –≥–æ–ª–æ—Å—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.",
      "–£–≥—Ä–æ–∑—ã –º–Ω–æ–∂–∞—Ç—Å—è, –Ω–æ –Ω–∞–¥–µ–∂–¥–∞ –µ—â—ë —Ç–µ–ø–ª–∏—Ç—Å—è.",
      "–ü–µ—Ä–µ–¥ –±—É—Ä–µ–π –≤—Å—ë —á–∞—â–µ —Å–ª—ã—à–Ω—ã —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Å–ª—É—Ö–∏."
    ]
  },
  {
    id:"II",
    label:"–ê–∫—Ç II",
    title:"–ü–µ–ø–µ–ª—å–Ω—ã–π —Ä–∞–∑–ª–æ–º",
    start:17,
    end:34,
    nightDecay:3,
    entryText:"–ê–∫—Ç II. –ü–µ–ø–µ–ª—å–Ω—ã–π —Ä–∞–∑–ª–æ–º: –≤—Ä–∞–≥–∏ —Å–º—ã–∫–∞—é—Ç –∫–æ–ª—å—Ü–æ, –Ω–æ—á–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ç—è–∂–µ–ª–µ–µ.",
    entryModifiers:{ morale:-5, trust:-5, safety:-5 },
    beats:[
      "–†–∞–∑–ª–æ–º –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã–µ –±–µ–¥—ã –∏ –º—Ä–∞—á–Ω—ã–µ —Å–ª—É—Ö–∏.",
      "–ö—Ä–∏–∑–∏—Å—ã –ø–µ—Ä–µ–ø–ª–µ—Ç–∞—é—Ç—Å—è, –∏—Å—Ç–æ—â–∞—è –∑–∞–ø–∞—Å—ã.",
      "–ö–∞–∂–¥–∞—è –Ω–æ—á—å –æ—Ç–Ω–∏–º–∞–µ—Ç –ª—é–¥–µ–π –∏ —Å–ª–æ–≤–∞.",
      "–û–±—â–∏–Ω–∞ –≤–∏—Å–∏—Ç –Ω–∞ –≤–æ–ª–æ—Å–∫–µ, –Ω–æ –µ—â—ë –¥–µ—Ä–∂–∏—Ç—Å—è."
    ]
  },
  {
    id:"III",
    label:"–ê–∫—Ç III",
    title:"–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Å–≤–µ—Ç",
    start:35,
    end:50,
    nightDecay:5,
    entryText:"–ê–∫—Ç III. –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—Å–≤–µ—Ç: –ë–µ–∑–º–æ–ª–≤–∏–µ —à–∞–≥–∞–µ—Ç –ø–æ —É–ª–∏—Ü–∞–º, –∏ –∫–∞–∂–¥–∞—è –∏—Å–∫—Ä–∞ –Ω–∞ —Å—á–µ—Ç—É.",
    entryModifiers:{ morale:-8, safety:-8, health:-5 },
    beats:[
      "–ì–æ—Ä–æ–¥ –æ–∫—Ä—É–∂—ë–Ω –≤—Ä–∞–≥–∞–º–∏, –∏ –∫–∞–∂–¥—ã–π —à—ë–ø–æ—Ç –Ω–∞ –≤–µ—Å –∑–æ–ª–æ—Ç–∞.",
      "–¢–∏—à–∏–Ω–∞ –Ω–∞–±–∏—Ä–∞–µ—Ç —Å–∏–ª—É, —Å–æ–º–Ω–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç.",
      "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ—é–∑–Ω–∏–∫–∏ –µ–¥–≤–∞ –¥–µ—Ä–∂–∞—Ç—Å—è –Ω–∞ –Ω–æ–≥–∞—Ö.",
      "–§–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—Ä—è —Ä–µ—à–∏—Ç —Å—É–¥—å–±—É —è–∑—ã–∫–∞."
    ]
  }
];

const ACT_SCALING = {
  I:{ positive:1, negative:1 },
  II:{ positive:1.15, negative:1.3 },
  III:{ positive:1.25, negative:1.6 }
};

const VISITOR_LIBRARY = {
  healer:{
    name:"–ó–Ω–∞—Ö–∞—Ä–∫–∞ –ú–∞—Ä—Ñ–∞",
    portrait:"üëµ",
    problem:"–ë–æ–ª–µ–∑–Ω—å",
    descriptions:{
      I:"–í –¥–µ—Ä–µ–≤–Ω–µ –≤—Å–ø—ã—Ö–Ω—É–ª–∞ <span class='problem-keyword'>–ë–æ–ª–µ–∑–Ω—å</span>. –ú–∞—Ä—Ñ–∞ –ø—Ä–æ—Å–∏—Ç —Å–ª–æ–≤–∞ –ª–µ—á–µ–Ω–∏—è.",
      II:"–≠–ø–∏–¥–µ–º–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è: <span class='problem-keyword'>–ë–æ–ª–µ–∑–Ω—å</span> –∏–¥—ë—Ç –æ—Ç –¥–æ–º–∞ –∫ –¥–æ–º—É.",
      III:"–ß—É–º–∞ –∫–æ—Å–∏—Ç –≤—Å–µ—Ö –ø–æ–¥—Ä—è–¥. –ú–∞—Ä—Ñ–∞ —É–º–æ–ª—è–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å <span class='problem-keyword'>–ë–æ–ª–µ–∑–Ω—å</span>."
    },
    solutions:{
      "med1":{health:10,trust:4,message:"–õ–µ–∫–∞—Ä—Å—Ç–≤–æ –æ–±–ª–µ–≥—á–∞–µ—Ç —Å—Ç—Ä–∞–¥–∞–Ω–∏—è."},
      "med2":{health:16,trust:7,message:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª—é–¥–µ–π –∫ –∂–∏–∑–Ω–∏."},
      "med3":{health:6,message:"–¢—Ä–∞–≤—ã –Ω–µ–º–Ω–æ–≥–æ –ø–æ–º–æ–≥–∞—é—Ç."},
      "med6":{health:12,safety:5,message:"–ö–∞—Ä–∞–Ω—Ç–∏–Ω —Å–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ."},
      "default":{health:-6,trust:-3,message:"–ë–æ–ª–µ–∑–Ω—å —Ä–∞—Å–ø–æ–ª–∑–∞–µ—Ç—Å—è –±–µ–∑ —Å–ª–æ–≤."}
    }
  },
  hunger:{
    name:"–ì–æ–ª–æ–¥–Ω—ã–π —Ä–µ–±—ë–Ω–æ–∫",
    portrait:"üë¶",
    problem:"–ì–æ–ª–æ–¥",
    descriptions:{
      I:"–ü–∞–π–∫–∏ —Ç–∞—é—Ç, <span class='problem-keyword'>–ì–æ–ª–æ–¥</span> –º—É—á–∞–µ—Ç —Å–µ–º—å–∏.",
      II:"–û—á–µ—Ä–µ–¥–∏ –∑–∞ –ø–∞–π–∫–æ–º —Ä–∞—Å—Ç—É—Ç, <span class='problem-keyword'>–ì–æ–ª–æ–¥</span> —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç—á–∞—è–Ω–Ω—ã–º.",
      III:"–ü—É—Å—Ç—ã–µ –º–∏—Å–∫–∏ –∏ –≥–ª–∞–∑–∞ –±–µ–∑ –Ω–∞–¥–µ–∂–¥—ã ‚Äî <span class='problem-keyword'>–ì–æ–ª–æ–¥</span> –ø–æ–∂–∏—Ä–∞–µ—Ç –ø–æ—Å–µ–ª–µ–Ω–∏–µ."
    },
    solutions:{
      "res1":{food:8,morale:5,message:"–•–ª–µ–± —É—Ç–æ–ª—è–µ—Ç –≥–æ–ª–æ–¥ –∏ –¥–∞—ë—Ç —Å–∏–ª—ã."},
      "res2":{food:5,message:"–ó–µ—Ä–Ω–æ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç –≤ –ø—Ä–æ—Å—Ç—É—é –∫–∞—à—É."},
      "nat3":{food:3,health:2,message:"–í–æ–¥–∞ —á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∂–∏–∑–Ω—å."},
      "default":{food:-4,morale:-3,message:"–ì–æ–ª–æ–¥ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è –∏ –∫—Ä–∞–¥—ë—Ç –Ω–∞–¥–µ–∂–¥—É."}
    }
  },
  farmer:{
    name:"–§–µ—Ä–º–µ—Ä –ò–≤–∞–Ω",
    portrait:"üë®‚Äçüåæ",
    problem:"–ó–∞—Å—É—Ö–∞",
    descriptions:{
      I:"–ü–æ–ª—è —Å–æ—Ö–Ω—É—Ç ‚Äî <span class='problem-keyword'>–ó–∞—Å—É—Ö–∞</span> –∑–∞–±–∏—Ä–∞–µ—Ç —É—Ä–æ–∂–∞–π.",
      II:"–ü–µ–ø–µ–ª—å–Ω—ã–π –≤–µ—Ç–µ—Ä —Å—É—à–∏—Ç –¥–∞–∂–µ –∫–æ–ª–æ–¥—Ü—ã ‚Äî <span class='problem-keyword'>–ó–∞—Å—É—Ö–∞</span> –Ω–µ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —à–∞–Ω—Å–æ–≤.",
      III:"–ó–µ–º–ª—è —Ä–∞—Å—Ç—Ä–µ—Å–∫–∞–ª–∞—Å—å, <span class='problem-keyword'>–ó–∞—Å—É—Ö–∞</span> –≥—Ä–æ–∑–∏—Ç –≥–∏–±–µ–ª—å—é –ø–æ—Å–µ–≤–æ–≤."
    },
    solutions:{
      "nat1":{food:14,morale:6,trust:6,message:"–î–æ–∂–¥—å —Å–ø–∞—Å–∞–µ—Ç –ø–æ–ª—è –∏ —Å–µ—Ä–¥—Ü–∞."},
      "nat3":{food:8,trust:4,message:"–í–æ–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–æ—Å—Ç —Ä–∞—Å—Ç–µ–Ω–∏–π."},
      "res3":{food:12,message:"–£—Ä–æ–∂–∞–π —Å–æ–∑—Ä–µ–≤–∞–µ—Ç –ø–æ–¥ –≤–∞—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏."},
      "nat2":{food:-10,safety:-6,message:"–ü–ª–∞–º—è —Å–∂–∏–≥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ—Å–µ–≤—ã."},
      "default":{food:-6,morale:-4,message:"–ó–∞—Å—É—Ö–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –º—É—á–∏—Ç—å —Ñ–µ—Ä–º–µ—Ä–æ–≤."}
    }
  },
  mother:{
    name:"–ò—Å–ø—É–≥–∞–Ω–Ω–∞—è –º–∞—Ç—å",
    portrait:"üë©",
    problem:"–°—Ç—Ä–∞—Ö",
    descriptions:{
      I:"–î–µ—Ç–∏ –±–æ—è—Ç—Å—è —Ç–µ–º–Ω–æ—Ç—ã ‚Äî <span class='problem-keyword'>–°—Ç—Ä–∞—Ö</span> –ª–∏—à–∞–µ—Ç —Å–Ω–∞.",
      II:"–ù–æ—á–Ω—ã–µ –∫—Ä–∏–∫–∏ –º–Ω–æ–∂–∞—Ç—Å—è, <span class='problem-keyword'>–°—Ç—Ä–∞—Ö</span> –∑–∞—Ä–∞–∂–∞–µ—Ç –≤–∑—Ä–æ—Å–ª—ã—Ö.",
      III:"–¢–µ–Ω–∏ —à–µ–ø—á—É—Ç –¥–µ—Ç—è–º, <span class='problem-keyword'>–°—Ç—Ä–∞—Ö</span> –ª–æ–º–∞–µ—Ç –∏—Ö –≤–æ–ª—é."
    },
    solutions:{
      "emo1":{morale:10,trust:5,message:"–ú—É–∂–µ—Å—Ç–≤–æ —É–∫—Ä–µ–ø–ª—è–µ—Ç —Å–µ—Ä–¥—Ü–∞."},
      "emo3":{morale:8,health:3,message:"–ü–æ–∫–æ–π –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–∏—Ö–∏–π —Å–æ–Ω."},
      "abs3":{morale:6,safety:2,message:"–°–≤–µ—Ç –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ç—å–º—É –∏–∑ –¥–æ–º–æ–≤."},
      "emo7":{morale:-9,health:-4,message:"–°—Ç—Ä–∞—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞—Ö."},
      "default":{morale:-4,message:"–°—Ç—Ä–∞—Ö –æ—Å—Ç–∞—ë—Ç—Å—è –∏ –º–Ω–æ–∂–∏—Ç—Å—è."}
    }
  },
  guard:{
    name:"–°—Ç—Ä–∞–∂–Ω–∏–∫",
    portrait:"üíÇ",
    problem:"–£–≥—Ä–æ–∑–∞",
    descriptions:{
      I:"–†–∞–∑–≤–µ–¥—á–∏–∫–∏ —Å–æ–æ–±—â–∞—é—Ç –æ <span class='problem-keyword'>–£–≥—Ä–æ–∑–µ</span> —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤.",
      II:"–ë–∞–Ω–¥—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —É –≤–æ—Ä–æ—Ç ‚Äî <span class='problem-keyword'>–£–≥—Ä–æ–∑–∞</span> —Ä–∞—Å—Ç—ë—Ç.",
      III:"–í—Ä–∞–≥–∏ –±—å—é—Ç —Ç–∞—Ä–∞–Ω–æ–º, <span class='problem-keyword'>–£–≥—Ä–æ–∑–∞</span> —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤."
    },
    solutions:{
      "res6":{safety:12,trust:6,message:"–û—Ä—É–∂–∏–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Ä–∞–≥–æ–≤ –≤–¥–∞–ª–∏."},
      "soc4":{safety:10,morale:6,message:"–ï–¥–∏–Ω—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π —É–∫—Ä–µ–ø–ª—è–µ—Ç –æ–±–æ—Ä–æ–Ω—É."},
      "nat8":{safety:7,message:"–¢—É–º–∞–Ω —Å–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Å–µ–ª–µ–Ω–∏–µ."},
      "emo7":{safety:-10,morale:-8,message:"–ü–∞–Ω–∏–∫–∞ –ª–æ–º–∞–µ—Ç —Å—Ç—Ä–æ–π."},
      "default":{safety:-7,morale:-4,message:"–£–≥—Ä–æ–∑–∞ –Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —É –≤–æ—Ä–æ—Ç."}
    }
  },
  elder:{
    name:"–°—Ç–∞—Ä–µ–π—à–∏–Ω–∞",
    portrait:"üë¥",
    problem:"–†–∞–∑–¥–æ—Ä",
    descriptions:{
      I:"–°—Å–æ—Ä—ã –∏–∑-–∑–∞ –≤–æ–¥—ã –∏ —Ö–ª–µ–±–∞ ‚Äî <span class='problem-keyword'>–†–∞–∑–¥–æ—Ä</span> —Ä–≤—ë—Ç –æ–±—â–∏–Ω—É.",
      II:"–°–æ–≤–µ—Ç —Ä–∞—Å–∫–æ–ª–æ—Ç, <span class='problem-keyword'>–†–∞–∑–¥–æ—Ä</span> —É–≥—Ä–æ–∂–∞–µ—Ç –ø–æ—Ä—è–¥–∫—É.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–ø–æ—Ä—ã –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ –¥—Ä–∞–∫–∏ ‚Äî <span class='problem-keyword'>–†–∞–∑–¥–æ—Ä</span> –º–æ–∂–µ—Ç —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å —Å–æ–≤–µ—Ç."
    },
    solutions:{
      "soc1":{safety:14,morale:9,trust:8,message:"–ú–∏—Ä–æ—Ç–≤–æ—Ä—Ü—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–æ–≥–ª–∞—Å–∏–µ."},
      "soc2":{safety:12,trust:8,message:"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫."},
      "soc3":{safety:10,trust:6,message:"–ó–∞–∫–æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É."},
      "default":{safety:-7,morale:-5,message:"–†–∞–∑–¥–æ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–∑—ä–µ–¥–∞—Ç—å –æ–±—â–∏–Ω—É."}
    }
  },
  patient:{
    name:"–ë–æ–ª—å–Ω–∞—è –∂–µ–Ω—â–∏–Ω–∞",
    portrait:"ü§í",
    problem:"–õ–∏—Ö–æ—Ä–∞–¥–∫–∞",
    descriptions:{
      I:"–ñ–∞—Ä –Ω–µ —Å–ø–∞–¥–∞–µ—Ç ‚Äî <span class='problem-keyword'>–õ–∏—Ö–æ—Ä–∞–¥–∫–∞</span> —É–±–∏–≤–∞–µ—Ç.",
      II:"–õ–∏—Ö–æ—Ä–∞–¥–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–æ–ª–Ω–∞–º–∏ –∏ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–≤–∞—Ä—Ç–∞–ª—ã.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–∏—Ö–æ—Ä–∞–¥–æ—á–Ω—ã–µ –≤—Å–ø—ã—à–∫–∏ –ª–∏—à–∞—é—Ç —Å–∏–ª –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤."
    },
    solutions:{
      "med1":{health:9,trust:5,message:"–õ–µ–∫–∞—Ä—Å—Ç–≤–æ —Å–Ω–∏–∂–∞–µ—Ç –∂–∞—Ä."},
      "med2":{health:15,trust:8,message:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ —Å–ø–∞—Å–∞–µ—Ç –∂–∏–∑–Ω—å."},
      "nat7":{health:5,message:"–õ—ë–¥ –æ—Ö–ª–∞–∂–¥–∞–µ—Ç —Ç–µ–ª–æ."},
      "default":{health:-7,trust:-4,message:"–õ–∏—Ö–æ—Ä–∞–¥–∫–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è."}
    }
  },
  merchant:{
    name:"–¢–æ—Ä–≥–æ–≤–µ—Ü",
    portrait:"üßî",
    problem:"–û–±–≤–∏–Ω–µ–Ω–∏–µ",
    descriptions:{
      I:"–¢–æ—Ä–≥–æ–≤—Ü–∞ –æ–±–≤–∏–Ω—è—é—Ç –≤ <span class='problem-keyword'>–û–±–º–∞–Ω–µ</span>.",
      II:"–†—ã–Ω–æ–∫ –±—É—Ä–ª–∏—Ç ‚Äî <span class='problem-keyword'>–û–±–º–∞–Ω</span> –≥—Ä–æ–∑–∏—Ç —Å–æ—Ä–≤–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫–∏.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Ä—É—à–∞—Ç—Å—è –∏–∑-–∑–∞ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–π –≤ <span class='problem-keyword'>–û–±–º–∞–Ω–µ</span>."
    },
    solutions:{
      "soc6":{trust:11,morale:6,message:"–ü—Ä–∞–≤–¥–∞ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–≥–æ–≤–æ—Ä."},
      "soc2":{trust:9,safety:5,message:"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π —Å—É–¥ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –≤—Å–µ—Ö."},
      "emo4":{trust:-7,safety:-8,message:"–ì–Ω–µ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ø–æ—Ä –≤ –¥—Ä–∞–∫—É."},
      "default":{trust:-5,morale:-3,message:"–ü–æ–¥–æ–∑—Ä–µ–Ω–∏—è –æ—Ç—Ç–∞–ª–∫–∏–≤–∞—é—Ç –ª—é–¥–µ–π."}
    }
  },
  refugees:{
    name:"–ë–µ–∂–µ–Ω—Ü—ã",
    portrait:"üë®‚Äçüë©‚Äçüëß",
    problem:"–ò–∑–≥–Ω–∞–Ω–∏–µ",
    descriptions:{
      I:"–ò–∑–≥–Ω–∞–Ω–Ω–∏–∫–∏ –∏—â—É—Ç –∑–∞—â–∏—Ç—É ‚Äî <span class='problem-keyword'>–ò–∑–≥–Ω–∞–Ω–∏–µ</span> –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç –∏—Ö.",
      II:"–ü–æ—Ç–æ–∫–∏ –±–µ–∂–µ–Ω—Ü–µ–≤ —Ä–∞—Å—Ç—É—Ç, –∏–º –≥—Ä–æ–∑–∏—Ç –Ω–æ–≤–æ–µ <span class='problem-keyword'>–ò–∑–≥–Ω–∞–Ω–∏–µ</span>.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ –ø—Ä–æ—Å—è—Ç —É–±–µ–∂–∏—â–µ –æ—Ç –ø–æ–ª–Ω–æ–≥–æ <span class='problem-keyword'>–ò–∑–≥–Ω–∞–Ω–∏—è</span>."
    },
    solutions:{
      "res5":{safety:8,morale:8,trust:7,message:"–£–±–µ–∂–∏—â–∞ —Ä–∞—Å–ø–∞—Ö–∏–≤–∞—é—Ç –¥–≤–µ—Ä–∏."},
      "emo6":{morale:10,trust:8,message:"–õ—é–±–æ–≤—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–∏—à–µ–ª—å—Ü–µ–≤."},
      "soc4":{morale:9,safety:5,message:"–ï–¥–∏–Ω—Å—Ç–≤–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—è–≥–æ—Ç—ã."},
      "default":{morale:-5,trust:-4,message:"–ë–µ–∂–µ–Ω—Ü—ã —É—Ö–æ–¥—è—Ç –≤ –ø—É—Å—Ç–æ—à–∏."}
    }
  },
  prophet:{
    name:"–ü—Ä–æ—Ä–æ–∫",
    portrait:"üîÆ",
    problem:"–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ",
    descriptions:{
      I:"–ü—Ä–æ—Ä–æ–∫ –≤–∏–¥–∏—Ç –º—Ä–∞—á–Ω–æ–µ <span class='problem-keyword'>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</span>.",
      II:"–ì–æ–ª–æ—Å–∞ –≥–æ–≤–æ—Ä—è—Ç –æ –Ω–µ–∏–∑–±–µ–∂–Ω–æ–π —Ç—å–º–µ ‚Äî <span class='problem-keyword'>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</span> –ø—É–≥–∞–µ—Ç –ª—é–¥–µ–π.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–µ–µ <span class='problem-keyword'>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</span> –æ–±–µ—â–∞–µ—Ç –ë–µ–∑–º–æ–ª–≤–∏–µ, –µ—Å–ª–∏ —Å–ª–æ–≤–∞ –∏—Å—Å—è–∫–Ω—É—Ç."
    },
    solutions:{
      "abs4":{morale:4,trust:7,message:"–°—É–¥—å–±—É –æ–∑–≤—É—á–∏–≤–∞—é—Ç —á–µ—Å—Ç–Ω–æ, –∏ –ª—é–¥–∏ –¥–µ—Ä–∂–∞—Ç—Å—è –≤–º–µ—Å—Ç–µ."},
      "emo2":{morale:11,trust:9,message:"–ù–∞–¥–µ–∂–¥–∞ –º–µ–Ω—è–µ—Ç —Ç–æ–Ω –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞."},
      "abs2":{morale:-12,health:-6,message:"–¢–∏—à–∏–Ω–∞ –ª–∏—à—å —É—Å–∫–æ—Ä—è–µ—Ç –º—Ä–∞–∫."},
      "default":{morale:-6,trust:-3,message:"–ü—É–≥–ª–∏–≤—ã–µ —Å–ª—É—Ö–∏ —à–∏—Ä—è—Ç—Å—è."}
    }
  },
  wounded:{
    name:"–†–∞–Ω–µ–Ω—ã–π –≤–æ–∏–Ω",
    portrait:"ü§ï",
    problem:"–†–∞–Ω–∞",
    descriptions:{
      I:"–ì–ª—É–±–æ–∫–∞—è <span class='problem-keyword'>–†–∞–Ω–∞</span> —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–≤.",
      II:"–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ —Å—Ç—ã—á–∫–∏ –æ—Å—Ç–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ <span class='problem-keyword'>–†–∞–Ω—ã</span>.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—â–∏—Ç–Ω–∏–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç –∫—Ä–æ–≤—å—é ‚Äî –∫–∞–∂–¥–∞—è <span class='problem-keyword'>–†–∞–Ω–∞</span> –æ–ø–∞—Å–Ω–∞."
    },
    solutions:{
      "med4":{health:11,trust:6,message:"–ü–µ—Ä–µ–≤—è–∑–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫—Ä–æ–≤—å."},
      "med2":{health:17,trust:10,message:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–Ω—É."},
      "nat7":{health:5,message:"–õ—ë–¥ –æ—Ö–ª–∞–∂–¥–∞–µ—Ç –∏ —É–º–µ–Ω—å—à–∞–µ—Ç –±–æ–ª—å."},
      "nat2":{health:-9,trust:-7,message:"–û–≥–æ–Ω—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏—á–∏–Ω—è–µ—Ç –±–æ–ª—å—à–µ —Å—Ç—Ä–∞–¥–∞–Ω–∏–π."},
      "default":{health:-8,message:"–†–∞–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∫—Ä–æ–≤–æ—Ç–æ—á–∏—Ç—å."}
    }
  },
  cultist:{
    name:"–ö—É–ª—å—Ç–∏—Å—Ç",
    portrait:"üë§",
    problem:"–ï—Ä–µ—Å—å",
    descriptions:{
      I:"–ö—É–ª—å—Ç–∏—Å—Ç —à–µ–ø—á–µ—Ç –æ —Å–ø–∞—Å–∏—Ç–µ–ª—å–Ω–æ–π <span class='problem-keyword'>–ï—Ä–µ—Å–∏</span>.",
      II:"–¢–æ–ª–ø—ã —Å–ª—É—à–∞—é—Ç <span class='problem-keyword'>–ï—Ä–µ—Å—å</span>, —Å–æ–º–Ω–µ–≤–∞—è—Å—å –≤ —Å–ª–æ–≤–∞—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.",
      III:"–ï—Ä–µ—Å—å –æ–±–µ—â–∞–µ—Ç —Ç–∏—à–∏–Ω—É –∏ –≥–∏–±–µ–ª—å —è–∑—ã–∫–∞."
    },
    solutions:{
      "soc5":{trust:12,morale:8,message:"–ó–Ω–∞–Ω–∏–µ —Ä–∞–∑–æ–±–ª–∞—á–∞–µ—Ç –ª–∂–µ—É—á–µ–Ω–∏–µ."},
      "soc6":{trust:10,safety:7,message:"–ü—Ä–∞–≤–¥–∞ —Ä–∞—Å—Å–µ–∏–≤–∞–µ—Ç –∫—É–ª—å—Ç."},
      "abs2":{trust:-18,morale:-12,message:"–¢–∏—à–∏–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ä—É–∂–∏–µ–º –∫—É–ª—å—Ç–∞."},
      "default":{trust:-7,safety:-5,message:"–ï—Ä–µ—Å—å —É–∫–æ—Ä–µ–Ω—è–µ—Ç—Å—è —Å—Ä–µ–¥–∏ –∂–∏—Ç–µ–ª–µ–π."}
    }
  },
  forgetful:{
    name:"–£–º–∏—Ä–∞—é—â–∏–π —Å—Ç–∞—Ä–∏–∫",
    portrait:"üë¥",
    problem:"–ó–∞–±–≤–µ–Ω–∏–µ",
    descriptions:{
      I:"–°—Ç–∞—Ä–∏–∫ –±–æ–∏—Ç—Å—è <span class='problem-keyword'>–ó–∞–±–≤–µ–Ω–∏—è</span>.",
      II:"–ü–∞–º—è—Ç—å –ø–æ–∫–æ–ª–µ–Ω–∏–π —Å—Ç–∏—Ä–∞–µ—Ç—Å—è ‚Äî <span class='problem-keyword'>–ó–∞–±–≤–µ–Ω–∏–µ</span> –∫—Ä–∞–¥—ë—Ç –∏—Å—Ç–æ—Ä–∏–∏.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–∏ –ø–∞–º—è—Ç–∏ —Å–¥–∞—é—Ç—Å—è <span class='problem-keyword'>–ó–∞–±–≤–µ–Ω–∏—é</span>."
    },
    solutions:{
      "abs5":{morale:12,trust:9,message:"–ü–∞–º—è—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Ä–æ–≥–∏–µ –ª–∏—Ü–∞."},
      "soc5":{morale:10,trust:7,message:"–ó–Ω–∞–Ω–∏–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é."},
      "abs1":{morale:7,message:"–í—Ä–µ–º—è —Ç–µ—á—ë—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –¥–∞–≤–∞—è –ø–æ–∫–æ–π."},
      "default":{morale:-6,trust:-3,message:"–ó–∞–±–≤–µ–Ω–∏–µ –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è."}
    }
  },
  scout:{
    name:"–†–∞–∑–≤–µ–¥—á–∏—Ü–∞ –ê–¥–µ–ª–∞",
    portrait:"üß≠",
    problem:"–û–ø–∞—Å–Ω–æ—Å—Ç—å",
    descriptions:{
      I:"–†–∞–∑–≤–µ–¥—á–∏—Ü–∞ –≤–∏–¥–∏—Ç –≤–¥–∞–ª–µ–∫–µ <span class='problem-keyword'>–û–ø–∞—Å–Ω–æ—Å—Ç—å</span>.",
      II:"–°–ª–µ–¥—ã –≤—Ä–∞–≥–æ–≤ –º–Ω–æ–∂–∞—Ç—Å—è ‚Äî <span class='problem-keyword'>–û–ø–∞—Å–Ω–æ—Å—Ç—å</span> –±–ª–∏–∑–∫–æ.",
      III:"–¢–µ–Ω–∏ –ø–æ–¥ —Å—Ç–µ–Ω–∞–º–∏ —Å–∫—Ä—ã–≤–∞—é—Ç —Å–º–µ—Ä—Ç–µ–ª—å–Ω—É—é <span class='problem-keyword'>–û–ø–∞—Å–Ω–æ—Å—Ç—å</span>."
    },
    solutions:{
      "nat8":{safety:6,message:"–¢—É–º–∞–Ω —Å–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Ç—å –≤—Ä–∞–≥–æ–≤."},
      "soc4":{safety:8,trust:4,message:"–ï–¥–∏–Ω—Å—Ç–≤–æ —Å–æ–±–∏—Ä–∞–µ—Ç –¥–æ–∑–æ—Ä—ã."},
      "res5":{safety:7,morale:3,message:"–£–±–µ–∂–∏—â–∞ —É–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–∫–∞—Ö."},
      "default":{safety:-5,morale:-3,message:"–û–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π."}
    }
  },
  smith:{
    name:"–ö—É–∑–Ω–µ—Ü –ü—ë—Ç—Ä",
    portrait:"‚öíÔ∏è",
    problem:"–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ",
    descriptions:{
      I:"–ö—É–∑–Ω–µ—Ü –ø—Ä–æ—Å–∏—Ç —Å–ª–æ–≤–∞ –¥–ª—è <span class='problem-keyword'>–°–Ω–∞—Ä—è–∂–µ–Ω–∏—è</span> –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤.",
      II:"–ö—É–∑–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —Å–Ω–∞ ‚Äî –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ <span class='problem-keyword'>–°–Ω–∞—Ä—è–∂–µ–Ω–∏—è</span>.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—á–∏ –ª–æ–º–∞—é—Ç—Å—è, <span class='problem-keyword'>–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ</span> –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è."
    },
    solutions:{
      "res4":{safety:7,trust:3,message:"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–∫—Ä–µ–ø–ª—è—é—Ç –æ–±–æ—Ä–æ–Ω—É."},
      "res6":{safety:11,morale:4,message:"–û—Ä—É–∂–∏–µ –ø—Ä–∏–¥–∞—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–∂–∞–º."},
      "soc4":{safety:9,trust:4,message:"–û–±—â–∏–Ω–∞ –¥–µ–ª–∏—Ç—Å—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –¥–ª—è –∫—É–∑–Ω–∏."},
      "default":{safety:-6,trust:-4,message:"–ë–µ–∑ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è —Å—Ç–µ–Ω—ã —Ö—Ä—É–ø–∫–∏."}
    }
  },
  rebels:{
    name:"–í–æ–∑–º—É—Ç–∏—Ç–µ–ª–∏",
    portrait:"üóØÔ∏è",
    problem:"–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏",
    descriptions:{
      I:"–¢–æ–ª–ø–∞ —Å–ø–æ—Ä–∏—Ç, <span class='problem-keyword'>–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏</span> –Ω–∞–∑—Ä–µ–≤–∞—é—Ç.",
      II:"–ì–Ω–µ–≤ –ø–µ—Ä–µ—Ä–∞—Å—Ç–∞–µ—Ç –≤ —É–ª–∏—á–Ω—ã–µ <span class='problem-keyword'>–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏</span>.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–π –±–∞—Å—Ç–∏–æ–Ω –µ–¥–≤–∞ —Å–¥–µ—Ä–∂–∏–≤–∞–µ—Ç <span class='problem-keyword'>–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏</span>."
    },
    solutions:{
      "soc1":{safety:10,morale:6,message:"–ú–∏—Ä–æ—Ç–≤–æ—Ä—Ü—ã —É—Å–ø–æ–∫–∞–∏–≤–∞—é—Ç —Ç–æ–ª–ø—É."},
      "soc2":{safety:9,trust:5,message:"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –æ—Ö–ª–∞–∂–¥–∞–µ—Ç –≥–æ–ª–æ–≤—ã."},
      "emo1":{morale:7,trust:4,message:"–ú—É–∂–µ—Å—Ç–≤–æ –ª–∏–¥–µ—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä."},
      "default":{safety:-8,morale:-6,message:"–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏ –ø–µ—Ä–µ—Ä–∞—Å—Ç–∞—é—Ç –≤ –ø–æ–±–æ–∏—â–µ."}
    }
  },
  marauders:{
    name:"–†–∞–∑–±–æ–π–Ω–∏—á—å—è —à–∞–π–∫–∞",
    portrait:"‚öîÔ∏è",
    problem:"–ù–∞–ø–∞–¥–µ–Ω–∏–µ",
    descriptions:{
      I:"–ú–µ–ª–∫–∏–µ –±–∞–Ω–¥—ã –≥–æ—Ç–æ–≤—è—Ç <span class='problem-keyword'>–ù–∞–ø–∞–¥–µ–Ω–∏–µ</span>.",
      II:"–†–∞–∑–±–æ–π–Ω–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ –∫—Ä—É–ø–Ω—ã–µ –æ—Ç—Ä—è–¥—ã –¥–ª—è <span class='problem-keyword'>–ù–∞–ø–∞–¥–µ–Ω–∏—è</span>.",
      III:"–û—Ç—á–∞—è–Ω–Ω—ã–µ –≤—Ä–∞–≥–∏ –±—Ä–æ—Å–∞—é—Ç –≤—Å–µ —Å–∏–ª—ã –Ω–∞ <span class='problem-keyword'>–ù–∞–ø–∞–¥–µ–Ω–∏–µ</span>."
    },
    solutions:{
      "res6":{safety:13,trust:5,message:"–û—Ä—É–∂–∏–µ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤."},
      "soc4":{safety:11,morale:5,message:"–ï–¥–∏–Ω—Å—Ç–≤–æ –∂–∏—Ç–µ–ª–µ–π –æ—Ç–±–∏–≤–∞–µ—Ç –Ω–∞–ª—ë—Ç."},
      "nat8":{safety:8,message:"–¢—É–º–∞–Ω –∏ –Ω–æ—á–Ω—ã–µ –¥–æ–∑–æ—Ä—ã —Å–∫—Ä—ã–≤–∞—é—Ç –ø–æ—Å–µ–ª–µ–Ω–∏–µ."},
      "default":{safety:-10,food:-5,message:"–†–∞–∑–±–æ–π–Ω–∏–∫–∏ –≥—Ä–∞–±—è—Ç –∏ –∂–≥—É—Ç."}
    }
  },
  plague:{
    name:"–ß—É–º–Ω–∞—è –ø–æ–≤–æ–∑–∫–∞",
    portrait:"‚ò†Ô∏è",
    problem:"–≠–ø–∏–¥–µ–º–∏—è",
    descriptions:{
      I:"–ü–µ—Ä–≤—ã–µ —Å–ª—É—Ö–∏ –æ <span class='problem-keyword'>–≠–ø–∏–¥–µ–º–∏–∏</span> –ø—É–≥–∞—é—Ç –ª—é–¥–µ–π.",
      II:"–ß—É–º–Ω–∞—è –ø–æ–≤–æ–∑–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —É –≤–æ—Ä–æ—Ç ‚Äî <span class='problem-keyword'>–≠–ø–∏–¥–µ–º–∏—è</span> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.",
      III:"–≠–ø–∏–¥–µ–º–∏—è –≤—ã–∫–∞—à–∏–≤–∞–µ—Ç —Ü–µ–ª—ã–µ –∫–≤–∞—Ä—Ç–∞–ª—ã."
    },
    solutions:{
      "med6":{health:14,safety:6,message:"–ö–∞—Ä–∞–Ω—Ç–∏–Ω –∑–∞–º–µ–¥–ª—è–µ—Ç –±–æ–ª–µ–∑–Ω—å."},
      "med2":{health:18,trust:8,message:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ —Å–ø–∞—Å–∞–µ—Ç —Ü–µ–ª—ã–µ —Å–µ–º—å–∏."},
      "med1":{health:12,message:"–õ–µ–∫–∞—Ä—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å–Ω—ã—Ö."},
      "default":{health:-12,morale:-6,message:"–≠–ø–∏–¥–µ–º–∏—è –≤—ã—Ä—ã–≤–∞–µ—Ç –∂–∏–∑–Ω–∏."}
    }
  },
  fire:{
    name:"–ü–æ–∂–∞—Ä –≤ –∫–≤–∞—Ä—Ç–∞–ª–µ",
    portrait:"üî•",
    problem:"–ü–ª–∞–º—è",
    descriptions:{
      I:"–ò—Å–∫—Ä—ã –≤—ã–∑—ã–≤–∞—é—Ç <span class='problem-keyword'>–ü–ª–∞–º—è</span> –Ω–∞ –æ–∫—Ä–∞–∏–Ω–µ.",
      II:"–ü–æ–∂–∞—Ä—ã –≤—Å–ø—ã—Ö–∏–≤–∞—é—Ç —Ä—è–¥–æ–º —Å–æ —Å—Ç–µ–Ω–∞–º–∏ ‚Äî <span class='problem-keyword'>–ü–ª–∞–º—è</span> —É–≥—Ä–æ–∂–∞–µ—Ç –≤—Å–µ–º.",
      III:"–ë–µ–∑–º–æ–ª–≤–Ω—ã–µ –ø–æ–¥–∂–∏–≥–∞—Ç–µ–ª–∏ —Ä–∞–∑–Ω–æ—Å—è—Ç <span class='problem-keyword'>–ü–ª–∞–º—è</span> –ø–æ –∫—Ä—ã—à–∞–º."
    },
    solutions:{
      "nat3":{safety:9,message:"–í–æ–¥–∞ –≥–∞—Å–∏—Ç –æ–≥–æ–Ω—å."},
      "res5":{safety:8,trust:3,message:"–£–±–µ–∂–∏—â–∞ —É–∫—Ä—ã–≤–∞—é—Ç —Å–µ–º—å–∏."},
      "nat8":{safety:6,message:"–¢—É–º–∞–Ω –¥—É—à–∏—Ç —è–∑—ã–∫–∏ –ø–ª–∞–º–µ–Ω–∏."},
      "default":{safety:-9,health:-6,message:"–ü–ª–∞–º—è –ø–æ–∂–∏—Ä–∞–µ—Ç —É–ª–∏—Ü—ã."}
    }
  },
  storm:{
    name:"–ü–µ–ø–µ–ª—å–Ω–∞—è –±—É—Ä—è",
    portrait:"üå™Ô∏è",
    problem:"–ë—É—Ä—è",
    descriptions:{
      I:"–†–µ–¥–∫–∞—è <span class='problem-keyword'>–ë—É—Ä—è</span> –Ω–µ—Å—ë—Ç –ø–µ–ø–µ–ª.",
      II:"–ü–µ–ø–µ–ª—å–Ω—ã–µ –±—É—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤–Ω–æ–≤—å –∏ –≤–Ω–æ–≤—å.",
      III:"–ë—É—Ä—è —Ä–≤—ë—Ç —É–∫—Ä—ã—Ç–∏—è –∏ –ª–æ–º–∞–µ—Ç –¥—É—à–∏."
    },
    solutions:{
      "nat1":{food:6,safety:5,message:"–î–æ–∂–¥—å —Å–º—ã–≤–∞–µ—Ç –ø–µ–ø–µ–ª."},
      "res5":{safety:7,morale:3,message:"–£–∫—Ä—ã—Ç–∏—è —Å–ø–∞—Å–∞—é—Ç –ª—é–¥–µ–π."},
      "abs3":{morale:5,trust:3,message:"–°–≤–µ—Ç –º–∞—è–∫–æ–≤ –≤–µ–¥—ë—Ç —Å–∫–≤–æ–∑—å –±—É—Ä—é."},
      "default":{food:-5,safety:-6,message:"–ë—É—Ä—è —Ä—É—à–∏—Ç –¥–æ–º–∞ –∏ –ø–æ–ª—è."}
    }
  },
  herald:{
    name:"–ì–ª–∞—à–∞—Ç–∞–π –ø—É—Å—Ç–æ—à–µ–π",
    portrait:"üìú",
    problem:"–°–ª—É—Ö–∏",
    descriptions:{
      I:"–°–ª—É—Ö–∏ —Ä–∞–∑–Ω–æ—Å—è—Ç—Å—è –≥–ª–∞—à–∞—Ç–∞–µ–º ‚Äî <span class='problem-keyword'>–°–ª—É—Ö–∏</span> —Ç—Ä–µ–≤–æ–∂–∞—Ç –ª—é–¥–µ–π.",
      II:"–°–ª—É—Ö–∏ –æ –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –æ—Ä—É–∂–∏–µ–º.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–µ—Å—Ç–∏ –æ–±–µ—â–∞—é—Ç —Å–∫–æ—Ä–æ–µ –ë–µ–∑–º–æ–ª–≤–∏–µ."
    },
    solutions:{
      "abs4":{trust:8,morale:4,message:"–°—É–¥—å–±–∞ –æ–∑–≤—É—á–µ–Ω–∞ —á–µ—Å—Ç–Ω–æ –∏ —è—Å–Ω–æ."},
      "soc6":{trust:10,message:"–ü—Ä–∞–≤–¥–∞ —Ä–∞—Å—Å–µ–∏–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ö–∏."},
      "emo2":{morale:6,trust:4,message:"–ù–∞–¥–µ–∂–¥–∞ –∑–≤—É—á–∏—Ç –≥—Ä–æ–º–∫–æ."},
      "default":{trust:-6,morale:-4,message:"–°–ª—É—Ö–∏ –ø–æ—Å–µ–ª–∏–ª–∏ —Å–æ–º–Ω–µ–Ω–∏—è."}
    }
  },
  scarcity:{
    name:"–ü—É—Å—Ç—ã–µ –∞–º–±–∞—Ä—ã",
    portrait:"ü•Ä",
    problem:"–ù–µ—Ö–≤–∞—Ç–∫–∞",
    descriptions:{
      I:"–ó–∞–ø–∞—Å—ã —É–º–µ–Ω—å—à–∞—é—Ç—Å—è ‚Äî –≥—Ä–æ–∑–∏—Ç <span class='problem-keyword'>–ù–µ—Ö–≤–∞—Ç–∫–∞</span>.",
      II:"–ê–º–±–∞—Ä—ã –ø—É—Å—Ç–µ—é—Ç, <span class='problem-keyword'>–ù–µ—Ö–≤–∞—Ç–∫–∞</span> —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è–≤–Ω–æ–π.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–µ—à–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç, <span class='problem-keyword'>–ù–µ—Ö–≤–∞—Ç–∫–∞</span> —É–≥—Ä–æ–∂–∞–µ—Ç –≤—Å–µ–º."
    },
    solutions:{
      "res1":{food:10,morale:4,message:"–•–ª–µ–± —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç —á–µ—Å—Ç–Ω–æ."},
      "res3":{food:12,trust:4,message:"–£—Ä–æ–∂–∞–π –∏–∑ —Ç–∞–π–Ω—ã—Ö –æ–≥–æ—Ä–æ–¥–æ–≤ —Å–ø–∞—Å–∞–µ—Ç."},
      "res2":{food:8,message:"–ó–µ—Ä–Ω–æ –ø–µ—Ä–µ–º–∞–ª—ã–≤–∞—é—Ç –≤ –º—É–∫—É."},
      "default":{food:-10,morale:-6,message:"–ê–º–±–∞—Ä—ã –∑–≤–µ–Ω—è—Ç –ø—É—Å—Ç–æ—Ç–æ–π."}
    }
  },
  siege:{
    name:"–û—Å–∞–¥–∞",
    portrait:"üè∞",
    problem:"–û—Å–∞–¥–∞",
    descriptions:{
      I:"–†–∞–∑–≤–µ–¥–∫–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ –≥—Ä—è–¥—É—â–µ–π <span class='problem-keyword'>–û—Å–∞–¥–∞</span>.",
      II:"–í—Ä–∞–≥–∏ –∫–æ–ª—å—Ü–æ–º –æ–∫—Ä—É–∂–∞—é—Ç —Å—Ç–µ–Ω—ã ‚Äî <span class='problem-keyword'>–û—Å–∞–¥–∞</span> —Ç—è–Ω–µ—Ç—Å—è.",
      III:"–û—Å–∞–¥–∞ –¥–ª–∏—Ç—Å—è –Ω–µ–¥–µ–ª—è–º–∏, —Å–∏–ª—ã –Ω–∞ –∏—Å—Ö–æ–¥–µ."
    },
    solutions:{
      "res6":{safety:12,message:"–û—Ä—É–∂–∏–µ –¥–µ—Ä–∂–∏—Ç –≤—Ä–∞–≥–æ–≤ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏."},
      "res5":{safety:10,morale:4,message:"–£–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ —É–±–µ–∂–∏—â–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç –Ω–∞—Ç–∏—Å–∫."},
      "soc4":{trust:6,safety:9,message:"–ï–¥–∏–Ω—Å—Ç–≤–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ."},
      "default":{safety:-12,food:-7,message:"–û—Å–∞–¥–∞ –∏—Å—Ç–æ—â–∞–µ—Ç –≥–æ—Ä–æ–¥."}
    }
  },
  shadow:{
    name:"–¢–µ–Ω—å –ë–µ–∑–º–æ–ª–≤–∏—è",
    portrait:"üåë",
    problem:"–û—Ç—á—É–∂–¥–µ–Ω–∏–µ",
    descriptions:{
      I:"–†–µ–¥–∫–∏–µ —Ç–µ–Ω–∏ —à–µ–ø—á—É—Ç –æ <span class='problem-keyword'>–û—Ç—á—É–∂–¥–µ–Ω–∏–∏</span>.",
      II:"–¢–µ–Ω—å –ë–µ–∑–º–æ–ª–≤–∏—è –ø—Ä–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ –¥–æ–º–∞ –∏ –≤—Å–µ–ª—è–µ—Ç <span class='problem-keyword'>–û—Ç—á—É–∂–¥–µ–Ω–∏–µ</span>.",
      III:"–¢–µ–Ω–∏ —Å—Ç—Ä–µ–º—è—Ç—Å—è –ø–æ–≥–ª–æ—Ç–∏—Ç—å –≤—Å–µ—Ö, –æ—Å—Ç–∞–≤–ª—è—è –ª–∏—à—å <span class='problem-keyword'>–û—Ç—á—É–∂–¥–µ–Ω–∏–µ</span>."
    },
    solutions:{
      "abs5":{morale:9,trust:6,message:"–ü–∞–º—è—Ç—å —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥—É—à–∏ –≤–º–µ—Å—Ç–µ."},
      "emo2":{morale:10,message:"–ù–∞–¥–µ–∂–¥–∞ —Ä–∞–∑–≥–æ–Ω—è–µ—Ç —Ç—å–º—É."},
      "abs3":{morale:7,safety:3,message:"–°–≤–µ—Ç –æ—Å–≤–µ—â–∞–µ—Ç –∑–∞–∫–æ—É–ª–∫–∏."},
      "default":{morale:-12,trust:-8,message:"–¢–µ–Ω–∏ —Ä–∞–∑–æ–±—â–∞—é—Ç –ª—é–¥–µ–π."}
    }
  },
  voidspeaker:{
    name:"–ü—Ä–æ—Ä–æ–∫ –ë–µ–∑–º–æ–ª–≤–∏—è",
    portrait:"‚ö´",
    problem:"–ö–æ–Ω–µ—Ü",
    descriptions:{
      I:"–¢–∏—Ö–∏–π —Å—Ç—Ä–∞–Ω–Ω–∏–∫ —à–µ–ø—á–µ—Ç –æ <span class='problem-keyword'>–ö–æ–Ω—Ü–µ</span> —Å–ª–æ–≤.",
      II:"–ü—Ä–æ—Ä–æ–∫ –ë–µ–∑–º–æ–ª–≤–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª–ø—ã –∏ –æ–±–µ—â–∞–µ—Ç <span class='problem-keyword'>–ö–æ–Ω–µ—Ü</span> —Ä–µ—á–∏.",
      III:"–ë–µ–∑–º–æ–ª–≤–∏–µ —Å—Ç–æ–∏—Ç —É –ø–æ—Ä–æ–≥–∞ ‚Äî –ø—Ä–æ—Ä–æ–∫ —Ç—Ä–µ–±—É–µ—Ç —Å–º–∏—Ä–∏—Ç—å—Å—è —Å <span class='problem-keyword'>–ö–æ–Ω—Ü–æ–º</span>."
    },
    solutions:{
      "soc5":{health:18,food:18,safety:18,morale:18,trust:22,message:"–ó–Ω–∞–Ω–∏–µ –æ—Ç–≥–æ–Ω—è–µ—Ç –ë–µ–∑–º–æ–ª–≤–∏–µ."},
      "emo2":{morale:16,trust:12,message:"–ù–∞–¥–µ–∂–¥–∞ –≤–æ–∑–≤–æ–¥–∏—Ç –Ω–µ–≤–∏–¥–∏–º—ã–µ —Å—Ç–µ–Ω—ã."},
      "emo6":{health:12,morale:16,trust:12,message:"–õ—é–±–æ–≤—å —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–∞."},
      "abs2":{health:-32,food:-32,safety:-32,morale:-32,trust:-32,message:"–¢–∏—à–∏–Ω–∞ –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤—Å—ë –∂–∏–≤–æ–µ."},
      "default":{health:-18,food:-18,safety:-18,morale:-18,trust:-18,message:"–ë–µ–∑–º–æ–ª–≤–∏–µ –Ω–∞–±–∏—Ä–∞–µ—Ç —Å–∏–ª—É."}
    }
  },
  lastHope:{
    name:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ",
    portrait:"üë•",
    problem:"–û—Ç—á–∞—è–Ω–∏–µ",
    descriptions:{
      I:"–ò–∑—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—É—Ç–Ω–∏–∫–∏ –±–æ—è—Ç—Å—è <span class='problem-keyword'>–û—Ç—á–∞—è–Ω–∏—è</span>.",
      II:"–û—Ç—á–∞—è–≤—à–∏–µ—Å—è –ø—Ä–æ—Å—è—Ç —Å–ª–æ–≤–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—É—Ç—å.",
      III:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ —Å—Ç–æ—è—Ç –Ω–∞ –∫–æ–ª–µ–Ω—è—Ö –ø–µ—Ä–µ–¥ –ª–∏—Ü–æ–º <span class='problem-keyword'>–û—Ç—á–∞—è–Ω–∏—è</span>."
    },
    solutions:{
      "emo2":{morale:14,trust:10,message:"–ù–∞–¥–µ–∂–¥–∞ –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç –≤ —Å–µ—Ä–¥—Ü–∞—Ö."},
      "emo5":{morale:12,health:6,message:"–†–∞–¥–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–ª—ã."},
      "emo8":{morale:-16,health:-12,message:"–û—Ç—á–∞—è–Ω–∏–µ –ø–æ–≥–ª–æ—â–∞–µ—Ç –≤—Å–µ—Ö."},
      "default":{morale:-10,health:-6,message:"–û—Ç—á–∞—è–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—è–∂–µ–ª–µ–µ."}
    }
  }
};

const ACT_BLUEPRINTS = {
  I:[
    {
      headline:"–ü–µ—Ä–≤—ã–µ –ø—Ä–æ—Å–∏—Ç–µ–ª–∏ —É –ø–æ—Ä–æ–≥–∞",
      narrative:"–í –±–∏–±–ª–∏–æ—Ç–µ–∫—É –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–µ—Ä–≤—ã–µ –ø—Ä–æ—Å–∏—Ç–µ–ª–∏, –ø—Ä–æ—Å—è —Å–ª–æ–≤–∞ –ø—Ä–æ—Ç–∏–≤ –±–æ–ª–µ–∑–Ω–∏ –∏ –≥–æ–ª–æ–¥–∞.",
      visitors:["healer","hunger"]
    },
    {
      headline:"–ó–∞—Å—É—Ö–∞ –∏ —Å—Ç—Ä–∞—Ö",
      narrative:"–ü–æ–ª—è —Å–æ—Ö–Ω—É—Ç, –¥–µ—Ç–∏ –±–æ—è—Ç—Å—è —Ç—å–º—ã ‚Äî –≤—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–ª–æ–≤–∞.",
      visitors:["farmer","mother"]
    },
    {
      headline:"–°–ø–æ—Ä—ã –æ –∑–∞—â–∏—Ç–µ",
      narrative:"–°—Ç—Ä–∞–∂–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–º–æ—â–∏, –∞ —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã —Å–ø–æ—Ä—è—Ç –æ –ø–æ—Ä—è–¥–∫–µ.",
      visitors:["guard","elder"]
    },
    {
      headline:"–õ–∏—Ö–æ—Ä–∞–¥–∫–∞ –∏ –æ–±–≤–∏–Ω–µ–Ω–∏—è",
      narrative:"–ñ–∞—Ä –∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ —É–ª–∏—Ü–∞–º.",
      visitors:["patient","merchant"],
      event:{ type:"discovery", title:"–ù–∞–π–¥–µ–Ω —Å–≤–∏—Ç–æ–∫", description:"–°—Ä–µ–¥–∏ –ø–µ–ø–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å–ª–æ–≤–∞:", words:["–©–∏—Ç","–ú–æ–ª–æ—Ç","–ö–ª—é—á"], choose:1 }
    },
    {
      headline:"–ë–µ–∂–µ–Ω—Ü—ã –∑–∞ –≤–æ—Ä–æ—Ç–∞–º–∏",
      narrative:"–ü–µ—Ä–≤—ã–π –ø–æ—Ç–æ–∫ –±–µ–∂–µ–Ω—Ü–µ–≤ –∏ —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞ —Å—Ç—É—á–∞—Ç—Å—è –≤ –¥–≤–µ—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.",
      visitors:["refugees","prophet"]
    },
    {
      headline:"–†–∞–Ω—ã –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ",
      narrative:"–ü–∞—Ç—Ä—É–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏, –∫—É–∑–Ω–µ—Ü —Ç—Ä–µ–±—É–µ—Ç –ø–æ–º–æ—â–∏.",
      visitors:["wounded","smith"],
      modifiers:{ safety:-2 },
      modifierText:"–ù–æ—á–Ω—ã–µ —Å—Ç—ã—á–∫–∏ –æ—Å–ª–∞–±–∏–ª–∏ –∫–∞—Ä–∞—É–ª—ã."
    },
    {
      headline:"–†–∞–∑–≤–µ–¥–∫–∞ –æ –ø–æ–∂–∞—Ä–∞—Ö",
      narrative:"–†–∞–∑–≤–µ–¥—á–∏—Ü–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ –ø–æ–∂–∞—Ä–∞—Ö –≤–¥–∞–ª–µ–∫–µ, –∞ –≥–æ–ª–æ–¥–Ω—ã–µ –¥–µ—Ç–∏ –∂–¥—É—Ç —Å–ª–æ–≤–∞.",
      visitors:["scout","hunger"]
    },
    {
      headline:"–ù–µ—Å–ø–æ–∫–æ–π–Ω–∞—è –Ω–æ—á—å",
      narrative:"–ú–∞—Ç–µ—Ä–∏, –∑–Ω–∞—Ö–∞—Ä–∫–∞ –∏ —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã –∏—â—É—Ç —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã —É—Å–ø–æ–∫–æ–∏—Ç—å –ª—é–¥–µ–π.",
      visitors:["mother","healer","elder"]
    },
    {
      headline:"–ü–∞–º—è—Ç—å –∏ —É—Ä–æ–∂–∞–π",
      narrative:"–§–µ—Ä–º–µ—Ä—ã —Å–ø–æ—Ä—è—Ç –æ –≤–æ–¥–µ, –∞ —Å—Ç–∞—Ä–∏–∫–∏ —Ç–µ—Ä—è—é—Ç –ø–∞–º—è—Ç—å –æ –ø–æ–ª—è—Ö.",
      visitors:["farmer","forgetful"],
      event:{ type:"discovery", title:"–ü–µ—Å–Ω—å —Ä–æ–¥–Ω–∏–∫–∞", description:"–≠—Ö–æ –ø—Ä–æ—à–ª–æ–≥–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞:", words:["–°–≤–µ—Ç–æ—á","–û–ø–ª–æ—Ç","–ó–∞–≤–µ—Ç"], choose:2 }
    },
    {
      headline:"–ü–æ—Å—Ç–∞–≤–∫–∞ –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π",
      narrative:"–ö–∞—Ä–∞–≤–∞–Ω—ã –æ–ø–∞–∑–¥—ã–≤–∞—é—Ç, —Ç–æ—Ä–≥–æ–≤—Ü—ã –∏ —Å—Ç—Ä–∞–∂–∞ —Ç—Ä–µ–±—É—é—Ç —Ä–µ—à–µ–Ω–∏—è.",
      visitors:["guard","merchant","hunger"]
    },
    {
      headline:"–í–µ—Å—Ç–∏ —Å –¥–æ—Ä–æ–≥",
      narrative:"–ë–µ–∂–µ–Ω—Ü—ã –∏ —Ä–∞–∑–≤–µ–¥—á–∏—Ü–∞ –ø—Ä–∏–Ω–æ—Å—è—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ –¥–∞–ª—å–Ω–∏—Ö —Å—ë–ª–∞—Ö.",
      visitors:["refugees","scout"]
    },
    {
      headline:"–ñ–∞—Ä —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è",
      narrative:"–õ–∏—Ö–æ—Ä–∞–¥–∫–∞ –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç —Å –Ω–æ–≤–æ–π —Å–∏–ª–æ–π, –º–∞—Ç–µ—Ä–∏ –∏—â—É—Ç —Å–ª–æ–≤–∞ —É—Ç–µ—à–µ–Ω–∏—è.",
      visitors:["patient","mother","healer"]
    },
    {
      headline:"–ö—É–∑–Ω—è –∏ —Å–æ–≤–µ—Ç",
      narrative:"–ö—É–∑–Ω–µ—Ü –∏ —Å—Ç—Ä–∞–∂–∞ —Ç—Ä–µ–±—É—é—Ç —Ä–µ—Å—É—Ä—Å–æ–≤, —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã —Å–ø–æ—Ä—è—Ç –æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏.",
      visitors:["smith","guard","elder"],
      modifiers:{ trust:-2 },
      modifierText:"–°–ª—É—Ö–∏ –æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –ø–æ–¥—Ç–∞—á–∏–≤–∞—é—Ç –¥–æ–≤–µ—Ä–∏–µ."
    },
    {
      headline:"–ü—Ä–∏–∑—Ä–∞–∫–∏ –ø—Ä–æ—à–ª–æ–≥–æ",
      narrative:"–ü—Ä–æ—Ä–æ–∫–∏ –∏ –∑–∞–±—ã–≤—á–∏–≤—ã–µ —Å—Ç–∞—Ä—Ü—ã —à–µ–ø—á—É—Ç –æ –≥—Ä—è–¥—É—â–µ–º –º–æ–ª—á–∞–Ω–∏–∏.",
      visitors:["prophet","forgetful"],
      event:{ type:"discovery", title:"–¢–∞–π–Ω—ã–π —á–µ—Ä–¥–∞–∫", description:"–í –ø—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã —Å–ª–æ–≤–∞:", words:["–≠—Ö–æ","–ë–∞—Å—Ç–∏–æ–Ω","–ü–ª–∞–º—è"], choose:1 }
    },
    {
      headline:"–¢–æ–ª–ø—ã —É –≤–æ—Ä–æ—Ç",
      narrative:"–†–∞–Ω–µ–Ω—ã–µ, –≥–æ–ª–æ–¥–Ω—ã–µ –∏ –∏—Å–ø—É–≥–∞–Ω–Ω—ã–µ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞ —Å–ª–æ–≤–æ–º.",
      visitors:["wounded","hunger","mother"]
    },
    {
      headline:"–ì—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–µ—â–∏—Ç",
      narrative:"–ó–Ω–∞—Ö–∞—Ä–∫–∞, –±–µ–∂–µ–Ω—Ü—ã –∏ —Ä–∞–∑–≤–µ–¥—á–∏—Ü–∞ —Ç—Ä–µ–±—É—é—Ç —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã—Ö —Å–ª–æ–≤ –ø–µ—Ä–µ–¥ –±—É—Ä–µ–π.",
      visitors:["healer","refugees","scout"],
      modifiers:{ safety:-3 },
      modifierText:"–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –æ–±–Ω–∞–∂–∏–ª–æ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞."
    }
  ],
  II:[
    {
      headline:"–ß—É–º–∞ –∏ –≥–æ–ª–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è",
      narrative:"–ß—É–º–Ω–∞—è –ø–æ–≤–æ–∑–∫–∞ –∏ –≥–æ–ª–æ–¥–∞—é—â–∏–µ —Ç–æ–ª–ø—è—Ç—Å—è —É –≤—Ä–∞—Ç; —Å—Ç—Ä–∞–∂–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–≤.",
      visitors:["plague","hunger","guard"],
      modifiers:{ health:-4 },
      modifierText:"–ù–æ—á—å –ø—Ä–∏–Ω–µ—Å–ª–∞ –Ω–æ–≤—ã—Ö –∑–∞–±–æ–ª–µ–≤—à–∏—Ö."
    },
    {
      headline:"–ó–µ—Ä–Ω–æ –ø–æ–¥ –æ—Ö—Ä–∞–Ω–æ–π",
      narrative:"–§–µ—Ä–º–µ—Ä—ã —Å–ø–æ—Ä—è—Ç —Å –≤–æ–∑–º—É—Ç–∏—Ç–µ–ª—è–º–∏, —Ç–æ—Ä–≥–æ–≤—Ü—ã –Ω–∞–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞—Ö–µ.",
      visitors:["farmer","rebels","merchant"]
    },
    {
      headline:"–†–∞–∑–±–æ–π–Ω–∏—á—å–∏ –≤—ã–ª–∞–∑–∫–∏",
      narrative:"–†–∞–∑–±–æ–π–Ω–∏–∫–∏ –∂–≥—É—Ç —Å–µ–ª–µ–Ω–∏—è, –∞ —Å–µ–º—å–∏ –ø—Ä—è—á—É—Ç—Å—è –æ—Ç –Ω–æ—á–Ω—ã—Ö –∫—Ä–∏–∫–æ–≤.",
      visitors:["marauders","smith","mother"]
    },
    {
      headline:"–ë–µ–∂–µ–Ω—Ü—ã –Ω–µ—Å—É—Ç –∑–∞—Ä–∞–∑—É",
      narrative:"–ù–æ–≤—ã–µ —Å–µ–º—å–∏ –ø—Ä–∏–Ω–æ—Å—è—Ç –±–æ–ª–µ–∑–Ω–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É.",
      visitors:["refugees","plague","cultist"]
    },
    {
      headline:"–ü–æ–∂–∞—Ä—ã —É —Å—Ç–µ–Ω",
      narrative:"–ü–ª–∞–º—è –≤—Å–ø—ã—Ö–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ —É —Å—Ç–µ–Ω—ã, –ø–∞—Ç—Ä—É–ª–∏ –∏—Å—Ç–æ—â–µ–Ω—ã.",
      visitors:["guard","fire","healer"]
    },
    {
      headline:"–°–ª—É—Ö–∏ –æ –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ",
      narrative:"–ì–ª–∞—à–∞—Ç–∞–∏ —Ä–∞–∑–Ω–æ—Å—è—Ç —Å–ª—É—Ö–∏, —Ñ–µ—Ä–º–µ—Ä—ã –∏ —Ç–æ–ª–ø–∞ —Ç—Ä–µ–±—É—é—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏.",
      visitors:["farmer","hunger","rebels","herald"],
      event:{ type:"discovery", title:"–ö–æ–¥–µ–∫—Å –∫–∞—Ä–∞–≤–∞–Ω–∞", description:"–ö–∞—Ä–∞–≤–∞–Ω—â–∏–∫–∏ –æ—Å—Ç–∞–≤–∏–ª–∏ –≤ –∫–Ω–∏–≥–µ —Å–ª–æ–≤–∞:", words:["–ö–∞—Ä–∞—É–ª","–ü—Ä–∏—Å—è–≥–∞","–ì—Ä–∞–Ω–∏—Ç"], choose:1 }
    },
    {
      headline:"–°–ª–µ–¥—ã –≤—Ä–∞–≥–∞",
      narrative:"–†–∞–∑–≤–µ–¥—á–∏—Ü–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ –Ω–æ–≤—ã—Ö —à–∞–π–∫–∞—Ö, –±–µ–∂–µ–Ω—Ü—ã –∏—â—É—Ç —É–±–µ–∂–∏—â–∞.",
      visitors:["scout","marauders","refugees"],
      modifiers:{ food:-5 },
      modifierText:"–ü–µ—Ä–µ–∫—Ä—ã—Ç—ã–µ –¥–æ—Ä–æ–≥–∏ –ª–∏—à–∏–ª–∏ –ø–æ—Å–µ–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏ –∑–∞–ø–∞—Å–æ–≤."
    },
    {
      headline:"–õ–∏–≤–Ω–∏ –∏ –∂–∞—Ä",
      narrative:"–ë—É—Ä—è –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç –æ–±–ª–µ–≥—á–µ–Ω–∏—è –±–æ–ª—å–Ω—ã–º ‚Äî —Å–ª–æ–≤–∞ –Ω—É–∂–Ω—ã –≤—Å–µ–º.",
      visitors:["patient","healer","storm"]
    },
    {
      headline:"–û–±–≤–∏–Ω–µ–Ω–∏—è –≤ –∏–∑–º–µ–Ω–µ",
      narrative:"–¢–æ—Ä–≥–æ–≤—Ü—ã, —Å—Ç—Ä–∞–∂–∞ –∏ –∫—É–ª—å—Ç–∏—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Å–ª–æ–≤ –∏—Å—Ç–∏–Ω—ã.",
      visitors:["merchant","guard","cultist"]
    },
    {
      headline:"–ö—É–∑–Ω–∏ –±–µ–∑ –æ—Ç–¥—ã—Ö–∞",
      narrative:"–ö—É–∑–Ω–µ—Ü—ã –∏ –ª–µ–∫–∞—Ä–∏ —Ç—Ä—É–¥—è—Ç—Å—è —Ä—è–¥–æ–º —Å —á—É–º–Ω–æ–π —Ç–µ–ª–µ–≥–æ–π.",
      visitors:["wounded","smith","plague"],
      event:{ type:"discovery", title:"–°–æ–∫—Ä–æ–≤–∏—â–Ω–∏—Ü–∞ –∫—É–∑–Ω–µ—Ü–∞", description:"–í —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–æ–º –º–µ—Ç–∞–ª–ª–µ –ø—Ä–æ—á–µ—Ä—á–µ–Ω—ã —Å–ª–æ–≤–∞:", words:["–ö–ª–∏–Ω–æ–∫","–©–∏—Ç–æ–∫","–ö—Ä–µ–ø–æ—Å—Ç—å"], choose:2 }
    },
    {
      headline:"–¢–æ–ª–ø–∞ –Ω–∞ –≥—Ä–∞–Ω–∏ –±—É–Ω—Ç–∞",
      narrative:"–ì–ª–∞—à–∞—Ç–∞–∏ –∏ –º–∞—Ç–µ—Ä–∏ –ø—ã—Ç–∞—é—Ç—Å—è —É—Å–º–∏—Ä–∏—Ç—å —Ä–∞–∑–±—É—à–µ–≤–∞–≤—à—É—é—Å—è —Ç–æ–ª–ø—É.",
      visitors:["herald","mother","rebels"]
    },
    {
      headline:"–ü–æ–ª—è –≤ –æ–≥–Ω–µ",
      narrative:"–ü–æ–∂–∞—Ä—ã —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç —É—Ä–æ–∂–∞–π –∏ –∑–∞–ø–∞—Å —Ö–ª–µ–±–∞.",
      visitors:["fire","hunger","farmer"],
      modifiers:{ food:-6 },
      modifierText:"–ù–æ—á—å—é –∑–∞–≥–æ—Ä–µ–ª–∏—Å—å –∞–º–±–∞—Ä—ã."
    },
    {
      headline:"–°–Ω—ã –æ —Ç–∏—à–∏–Ω–µ",
      narrative:"–ü—Ä–æ—Ä–æ–∫–∏ –∏ –∫—É–ª—å—Ç–∏—Å—Ç—ã –ø—É–≥–∞—é—Ç –∑–∞–±—ã–≤—á–∏–≤—ã—Ö —Å—Ç–∞—Ä—Ü–µ–≤.",
      visitors:["forgetful","prophet","cultist"]
    },
    {
      headline:"–°—Ç–µ–Ω—ã –µ–¥–≤–∞ –¥–µ—Ä–∂–∞—Ç—Å—è",
      narrative:"–ë–µ–∂–µ–Ω—Ü—ã –∏ —Å—Ç—Ä–∞–∂–∞ –æ—Ç—Ä–∞–∂–∞—é—Ç –Ω–∞—Ç–∏—Å–∫ —Ä–∞–∑–±–æ–π–Ω–∏–∫–æ–≤.",
      visitors:["refugees","marauders","guard"]
    },
    {
      headline:"–ë—É—Ä—è —Å—Ä—ã–≤–∞–µ—Ç –∫—Ä—ã—à–∏",
      narrative:"–ü–µ–ø–µ–ª—å–Ω–∞—è –±—É—Ä—è —Ä–≤—ë—Ç –∫—Ä—ã—à–∏, –ª–µ–∫–∞—Ä–∏ –Ω–µ —É—Å–ø–µ–≤–∞—é—Ç –ø–æ–º–æ—á—å –≤—Å–µ–º.",
      visitors:["storm","hunger","healer"]
    },
    {
      headline:"–°–æ–≤–µ—Ç –æ—Å–∞–∂–¥—ë–Ω",
      narrative:"–≠–ø–∏–¥–µ–º–∏—è –∏ –±—É–Ω—Ç—ã –¥–æ–±–∏—Ä–∞—é—Ç—Å—è –¥–æ —Å–æ–≤–µ—Ç–∞ —Å—Ç–∞—Ä–µ–π—à–∏–Ω.",
      visitors:["plague","rebels","elder"],
      event:{ type:"discovery", title:"–¢–∞–π–Ω–∏–∫ —Å–æ–≤–µ—Ç–∞", description:"–í –∞—Ä—Ö–∏–≤–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å —Å–ª–æ–≤–∞:", words:["–ö–æ–¥–µ–∫—Å","–ö–ª—è—Ç–≤–∞","–ì–ª–∞—Å"], choose:1 }
    },
    {
      headline:"–¢–æ—Ä–≥–∏ –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å",
      narrative:"–¢–æ—Ä–≥–æ–≤—Ü—ã —Ç—Ä–µ–±—É—é—Ç –ø–ª–∞—Ç—É –∑–∞ –∑–∞—â–∏—Ç—É, –∫—É–∑–Ω–µ—Ü –∏ —Å—Ç—Ä–∞–∂–∞ —Å–ø–æ—Ä—è—Ç.",
      visitors:["merchant","smith","guard","hunger"]
    },
    {
      headline:"–ü—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è",
      narrative:"–ü—Ä–æ—Ä–æ–∫, –∫—É–ª—å—Ç–∏—Å—Ç –∏ –≥–ª–∞—à–∞—Ç–∞–π —Å–ø–æ—Ä—è—Ç –æ —Å—É–¥—å–±–µ —è–∑—ã–∫–∞.",
      visitors:["prophet","cultist","herald"],
      modifiers:{ morale:-5, trust:-4 },
      modifierText:"–°–æ–º–Ω–µ–Ω–∏—è —Ä–∞—Å–∫–∞—á–∏–≤–∞—é—Ç –ª—é–¥–µ–π."
    }
  ],
  III:[
    {
      headline:"–¢—Ä–∏ –±–µ–¥—ã —Å—Ä–∞–∑—É",
      narrative:"–ß—É–º–∞, –ø–æ–∂–∞—Ä –∏ –±—É–Ω—Ç –µ–¥–≤–∞ –Ω–µ –ª–æ–º–∞—é—Ç —Å—Ç–µ–Ω—ã.",
      visitors:["plague","fire","guard","rebels"],
      modifiers:{ health:-5, safety:-4 },
      modifierText:"–ù–æ—á—å –ø—Ä–æ—à–ª–∞ –≤ –¥—ã–º—É –∏ –∫—Ä–æ–≤–∏."
    },
    {
      headline:"–û—Å–∞–¥–∞ –∑–∞—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è",
      narrative:"–í—Ä–∞–≥–∏ –æ–∫—Ä—É–∂–∞—é—Ç –ø–æ—Å–µ–ª–µ–Ω–∏–µ, –∫—É–∑–Ω–∏—Ü—ã –≤—ã–¥—ã—Ö–∞—é—Ç—Å—è, –∑–∞–ø–∞—Å—ã —Ç–∞—é—Ç.",
      visitors:["siege","hunger","smith"]
    },
    {
      headline:"–ü—Ä–æ–ø–æ–≤–µ–¥–∏ –ë–µ–∑–º–æ–ª–≤–∏—è",
      narrative:"–ü—Ä–æ—Ä–æ–∫ –ë–µ–∑–º–æ–ª–≤–∏—è –∏ –∫—É–ª—å—Ç–∏—Å—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç —Ç–æ–ª–ø—ã —Å–æ–º–Ω–µ–≤–∞—é—â–∏—Ö—Å—è.",
      visitors:["voidspeaker","cultist","prophet"]
    },
    {
      headline:"–î–æ–∂–¥—å –Ω–∞–¥ —Ä–∞–Ω–∞–º–∏",
      narrative:"–†–∞–Ω–µ–Ω—ã–µ –∏ –±–æ–ª—å–Ω—ã–µ –∏—â—É—Ç —Å–ª–æ–≤–∞ —Å–ø–∞—Å–µ–Ω–∏—è –ø–æ–¥ –≥—É–ª –±—É—Ä–∏.",
      visitors:["wounded","healer","storm"]
    },
    {
      headline:"–¢–æ–ª–ø—ã —É –≤–æ—Ä–æ—Ç",
      narrative:"–ë–µ–∂–µ–Ω—Ü—ã, —Ä–∞–∑–±–æ–π–Ω–∏–∫–∏ –∏ –≥–æ–ª–æ–¥ —É–≥—Ä–æ–∂–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.",
      visitors:["refugees","marauders","guard","hunger"]
    },
    {
      headline:"–ü—É—Å—Ç—ã–µ —Å–∫–ª–∞–¥—ã",
      narrative:"–ê–º–±–∞—Ä—ã –ø—É—Å—Ç–µ—é—Ç, —Å—Ç–∞—Ä–µ–π—à–∏–Ω—ã —Å–æ–±–∏—Ä–∞—é—Ç —Å–æ–≤–µ—Ç.",
      visitors:["scarcity","merchant","elder"],
      event:{ type:"discovery", title:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏", description:"–ù–∞ –ø–æ–ª—è—Ö –∫–Ω–∏–≥–∏ –≤—ã—Ü–∞—Ä–∞–ø–∞–Ω—ã —Å–ª–æ–≤–∞:", words:["–ò—Å–∫—Ä–∞","–ö–ª—è—Ç–≤–∞","–ü–æ–∫—Ä–æ–≤"], choose:1 }
    },
    {
      headline:"–¢–µ–Ω–∏ –≤ –¥–æ–º–∞—Ö",
      narrative:"–¢–µ–Ω–∏ –ë–µ–∑–º–æ–ª–≤–∏—è –ø—Ä–æ–±–∏—Ä–∞—é—Ç—Å—è –∫ —Å–µ–º—å—è–º –∏ —Å—Ç–∞—Ä–∏–∫–∞–º.",
      visitors:["shadow","mother","forgetful"]
    },
    {
      headline:"–ï—Ä–µ—Å—å –∏ —á—É–º–∞",
      narrative:"–≠–ø–∏–¥–µ–º–∏—è –∏ –ø—Ä–æ–ø–æ–≤–µ–¥–Ω–∏–∫–∏ —Ç–∏—à–∏–Ω—ã –¥–µ–π—Å—Ç–≤—É—é—Ç –≤–º–µ—Å—Ç–µ.",
      visitors:["plague","voidspeaker","rebels"],
      event:{ type:"discovery", title:"–†–∞—Å—Å–≤–µ—Ç–Ω—ã–π –æ–±–µ—Ç", description:"–í –ø–æ–¥–∑–µ–º–µ–ª—å–µ –Ω–∞–π–¥–µ–Ω—ã —Å–ª–æ–≤–∞:", words:["–ë–∞—Ä—å–µ—Ä","–°–∏—è–Ω–∏–µ","–§–∞–∫–µ–ª"], choose:2 }
    },
    {
      headline:"–°—Ç–µ–Ω—ã –≤ –ø–ª–∞–º–µ–Ω–∏",
      narrative:"–ü–æ–∂–∞—Ä—ã –≤—Å–ø—ã—Ö–∏–≤–∞—é—Ç –ø—Ä—è–º–æ –Ω–∞ —Å—Ç–µ–Ω–∞—Ö –æ—Å–∞–∂–¥—ë–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞.",
      visitors:["siege","fire","smith","guard"]
    },
    {
      headline:"–ë—É—Ä—è –∏ –ø–ª–∞—á",
      narrative:"–î–µ—Ç–∏ –ø–ª–∞—á—É—Ç –ø–æ–¥ –≤–æ–π –ø–µ–ø–µ–ª—å–Ω–æ–π –±—É—Ä–∏.",
      visitors:["storm","hunger","healer","mother"]
    },
    {
      headline:"–ü—Ä–∞–≤–æ –Ω–∞ —É–±–µ–∂–∏—â–µ",
      narrative:"–ë–µ–∂–µ–Ω—Ü—ã —Å–ø–æ—Ä—è—Ç —Å –∫—É–ª—å—Ç–∏—Å—Ç–∞–º–∏, –≥–ª–∞—à–∞—Ç–∞–π —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è.",
      visitors:["refugees","cultist","herald"]
    },
    {
      headline:"–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ö–ª–µ–±",
      narrative:"–ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∏—â–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –±—É–Ω—Ç—É —É —Å–∫–ª–∞–¥–æ–≤.",
      visitors:["scarcity","merchant","rebels"],
      modifiers:{ food:-7 },
      modifierText:"–ù–æ—á–Ω–æ–π –Ω–∞–ª—ë—Ç —É–Ω–∏—á—Ç–æ–∂–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–µ—Ä–Ω–æ."
    },
    {
      headline:"–°—Ö–≤–∞—Ç–∫–∞ –∑–∞ —è–∑—ã–∫",
      narrative:"–ü—Ä–æ—Ä–æ–∫–∏ –∏ —Ç–µ–Ω–∏ —Å–ø–æ—Ä—è—Ç –æ —Å—É–¥—å–±–µ —Å–ª–æ–≤–∞.",
      visitors:["voidspeaker","shadow","prophet"]
    },
    {
      headline:"–ß—É–º–∞ –ø–æ–¥ —Å—Ç–µ–Ω–∞–º–∏",
      narrative:"–û—Å–∞–∂–¥—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∞–¥–∞—é—Ç –æ—Ç —á—É–º—ã –∏ –∂–∞–∂–¥—ã.",
      visitors:["plague","siege","healer"]
    },
    {
      headline:"–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç—Ä–æ–π",
      narrative:"–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –≤–∞–º, —Å—Ç—Ä–∞–∂–∏ –∏—Å—Ç–æ—â–µ–Ω—ã.",
      visitors:["lastHope","guard","hunger","smith"]
    },
    {
      headline:"–°—É–¥—å–±–∞ —è–∑—ã–∫–∞",
      narrative:"–ë–µ–∑–º–æ–ª–≤–∏–µ —Å—Ç–æ–∏—Ç —É –ø–æ—Ä–æ–≥–∞. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∂–∏–≤—à–∏–µ –∂–¥—É—Ç —Ä–µ—à–µ–Ω–∏—è.",
      visitors:["voidspeaker","lastHope","shadow"],
      modifiers:{ morale:-6, trust:-6 },
      modifierText:"–¢–∏—à–∏–Ω–∞ –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ —Å–µ—Ä–¥—Ü–∞.",
      finale:{
        endings:[
          {
            id:"radiant",
            className:"victory",
            title:"–ü–û–ë–ï–î–ê: –•—Ä–∞–Ω–∏—Ç–µ–ª–∏ –°–ª–æ–≤–∞",
            message:"–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–∏—è–µ—Ç —Å–≤–µ—Ç–æ–º –Ω–æ–≤—ã—Ö —Å–ª–æ–≤. –õ—é–¥–∏ –≤–µ—Ä—è—Ç –≤–∞—à–µ–º—É –≥–æ–ª–æ—Å—É.",
            condition:state=> state.remaining>=30 && state.minStat>=55
          },
          {
            id:"bastion",
            className:"victory",
            title:"–ü–û–ë–ï–î–ê: –ü–µ–ø–µ–ª—å–Ω—ã–π –±–∞—Å—Ç–∏–æ–Ω",
            message:"–ü–æ—Å–µ–ª–µ–Ω–∏–µ –≤—ã–∂–∏–ª–æ –∏ —É–¥–µ—Ä–∂–∞–ª–æ —è–∑—ã–∫ —Ü–µ–Ω–æ–π –æ–≥—Ä–æ–º–Ω—ã—Ö —É—Å–∏–ª–∏–π.",
            condition:state=> state.remaining>=18 && state.avgStat>=45
          },
          {
            id:"ember",
            className:"neutral",
            title:"–ü–û–°–õ–ï–î–ù–ò–ô –û–ì–û–ù–¨",
            message:state=>`–õ—é–¥–∏ –∂–∏–≤—ã, –Ω–æ —Å–ª–æ–≤–∞ –æ–±–æ–∂–∂–µ–Ω—ã –≤–æ–π–Ω–æ–π. –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–∏—à—å ${state.remaining} —Å–ª–æ–≤.`,
            condition:state=> state.remaining>=10 && state.minStat>=30
          }
        ],
        default:{
          id:"silence",
          className:"defeat",
          title:"–ö–û–ù–ï–¶: –ü–µ–ø–µ–ª –¢–∏—à–∏–Ω—ã",
          message:"–ë–µ–∑–º–æ–ª–≤–∏–µ –Ω–∞–∫—Ä—ã–≤–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Ä–∞—Å—Å—ã–ø–∞—é—Ç—Å—è –≤ –ø—Ä–∞—Ö."
        }
      }
    }
  ]
};

const campaignEvents = buildCampaignEvents();

function buildCampaignEvents(){
  const events = {};
  CAMPAIGN_ACTS.forEach(act=>{
    const sequences = ACT_BLUEPRINTS[act.id] || [];
    sequences.forEach((blueprint, index)=>{
      const dayNumber = act.start + index;
      const visitors = (blueprint.visitors || []).map(entry=>{
        if (typeof entry === "string") return cloneVisitor(entry, act.id);
        if (entry && typeof entry === "object" && entry.key) return cloneVisitor(entry.key, act.id);
        return entry ? JSON.parse(JSON.stringify(entry)) : entry;
      });
      const event = blueprint.event ? { ...blueprint.event, words:[...(blueprint.event.words||[])] } : undefined;
      const modifiers = blueprint.modifiers ? { ...blueprint.modifiers } : undefined;
      events[dayNumber] = {
        act:act.id,
        headline:blueprint.headline,
        narrative:blueprint.narrative,
        visitors,
        event,
        modifiers,
        modifierText:blueprint.modifierText,
        finale:blueprint.finale
      };
    });
  });
  return events;
}

function cloneVisitor(key, actId){
  const template = VISITOR_LIBRARY[key];
  if (!template){
    return {
      name:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≥–æ—Å—Ç—å",
      portrait:"‚ùî",
      description:"–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç —Å–ª–æ–≤–æ, –Ω–æ –≤—ã –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç.",
      solutions:{ default:{ morale:-3,message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ö–æ–¥–∏—Ç —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–º." } }
    };
  }
  const scaling = ACT_SCALING[actId] || ACT_SCALING.I;
  const descriptions = template.descriptions || {};
  const description = descriptions[actId] || descriptions.default || template.description || "";
  const visitor = {
    name:template.name,
    portrait:template.portrait,
    problem:template.problem,
    description,
    solutions:{}
  };
  Object.entries(template.solutions||{}).forEach(([wordId,effect])=>{
    visitor.solutions[wordId] = scaleEffect(effect, scaling);
  });
  return visitor;
}

function scaleEffect(effect, scaling){
  if (!effect) return {};
  const scaled = {};
  Object.keys(effect).forEach(key=>{
    if (key === "message") return;
    const value = effect[key];
    if (typeof value === "number"){
      if (value>0) scaled[key] = Math.round(value * (scaling?.positive || 1));
      else if (value<0) scaled[key] = Math.round(value * (scaling?.negative || 1));
      else scaled[key] = value;
    } else {
      scaled[key] = value;
    }
  });
  if (effect.message) scaled.message = effect.message;
  return scaled;
}

function getActForDay(day){
  return CAMPAIGN_ACTS.find(act=> day>=act.start && day<=act.end) || null;
}

function getActBeat(act, day){
  if (!act || !act.beats || !act.beats.length) return "";
  const totalDays = act.end - act.start + 1;
  const progress = Math.max(0, day - act.start);
  const ratio = totalDays>0 ? progress/totalDays : 0;
  const index = Math.min(act.beats.length-1, Math.floor(ratio * act.beats.length));
  return act.beats[index];
}


/* ===================== –£–¢–ò–õ–ò–¢–´ –°–ï–ô–í–û–í ===================== */
function hasSave(){ return !!localStorage.getItem('librarian_save'); }
function saveGame(){
  const save = {
    mode:gameState.mode, day:gameState.day, stats:gameState.stats,
    usedWords:[...gameState.usedWords], discoveredWords:gameState.discoveredWords,
    canCreateNeologism:gameState.canCreateNeologism, roguelikeScore:gameState.roguelikeScore,
    currentAct:gameState.currentAct, actsEntered:[...gameState.actsEntered], lastBeat:gameState.lastBeat,
    nightDecay:gameState.nightDecay, crisisFlags:gameState.crisisFlags
  };
  localStorage.setItem('librarian_save', JSON.stringify(save));
}
function continueGame(){
  const raw = localStorage.getItem('librarian_save'); if (!raw) return;
  const data = JSON.parse(raw);
  resetGame();
  Object.assign(gameState, {
    mode:data.mode||'campaign', day:data.day||1, stats:data.stats||{...DEFAULT_STATS},
    usedWords:new Set(data.usedWords||[]), discoveredWords:data.discoveredWords||[],
    canCreateNeologism: data.canCreateNeologism ?? 2, roguelikeScore:data.roguelikeScore||0,
    currentAct:data.currentAct||null, actsEntered:new Set(data.actsEntered||[]),
    lastBeat:data.lastBeat||null, nightDecay:data.nightDecay || gameState.nightDecay,
    crisisFlags:data.crisisFlags || gameState.crisisFlags
  });
  enterGame(); startDay();
}

/* ===================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===================== */
function init(){
  createParticles();
  if (hasSave()) document.getElementById('continue-btn').style.display='block';
  document.getElementById('word-search').addEventListener('input', e=>{
    const active = document.querySelector('.category-tab.active')?.dataset.category || 'all';
    renderWords(active, e.target.value);
  });
  document.addEventListener('keydown', e=>{
    if (e.key==='Escape') closeModal();
    if (e.key>='1' && e.key<='7'){ const idx=parseInt(e.key)-1; if (CATEGORIES[idx]) filterByCategory(CATEGORIES[idx]); }
    if (e.key==='Enter'){
      const btn = document.getElementById('give-word-btn');
      if (btn && !btn.disabled) giveWord();
    }
  });
}
window.addEventListener('DOMContentLoaded', init);

function createParticles(){
  for (let i=0;i<15;i++){
    const p=document.createElement('div'); p.className='ash-particle';
    p.style.left = Math.random()*100 + '%';
    p.style.animationDelay = Math.random()*12 + 's';
    p.style.animationDuration = (10 + Math.random()*8) + 's';
    document.body.appendChild(p);
  }
}

/* ===================== –°–¢–ê–†–¢ / –°–ë–†–û–° ===================== */
function startCampaign(){ resetGame(); gameState.mode='campaign'; enterGame(); startDay(); }
function startRoguelike(){ resetGame(); gameState.mode='roguelike'; gameState.nightDecay=5; enterGame(); startDay(); }
function resetGame(){
  gameState = {
    mode:'campaign', day:1, stats:{...DEFAULT_STATS}, currentVisitor:null, selectedWord:null,
    visitorsQueue:[], usedWords:new Set(), journal:[], canCreateNeologism:2, discoveredWords:[],
    roguelikeScore:0, ended:false, nightDecay:2, currentAct:null, actsEntered:new Set(), lastBeat:null,
    crisisFlags:{epidemic:false,famine:false,unrest:false},
    wordsUsedToday:[], snapshot:{}
  };
}
function enterGame(){
  document.getElementById('main-menu').style.opacity='0';
  setTimeout(()=>{
    document.getElementById('main-menu').style.display='none';
    document.getElementById('game-container').classList.add('visible');
    renderCategories(); renderWords(); updateStats(); updateWordCount();
  }, 1000);
}

/* ===================== –î–ï–ù–¨ / –ö–†–ò–ó–ò–°–´ ===================== */
function startDay(){
  const isCampaign = gameState.mode==='campaign';
  const dayData = isCampaign ? campaignEvents[gameState.day] : null;
  const act = isCampaign ? getActForDay(gameState.day) : null;
  if (act) gameState.nightDecay = act.nightDecay;

  gameState.snapshot = JSON.parse(JSON.stringify(gameState.stats));
  gameState.wordsUsedToday = [];

  if (gameState.day>1) applyNightDecay();
  checkCrises();

  if (isCampaign){
    if (!dayData){ victory(); return; }
    applyActState(act, dayData);
    const visitors = dayData.visitors || [];
    gameState.visitorsQueue = visitors.map(v=> JSON.parse(JSON.stringify(v)));

    if (gameState.crisisFlags.epidemic){
      gameState.visitorsQueue.push({ name:"–ë–æ–ª—å–Ω—ã–µ", portrait:"ü§¢", problem:"–≠–ø–∏–¥–µ–º–∏—è", description:"<span class='problem-keyword'>–≠–ø–∏–¥–µ–º–∏—è</span> –Ω–µ –æ—Ç—Å—Ç—É–ø–∞–µ—Ç!", solutions:{
        "med6":{health:10,message:"–ö–∞—Ä–∞–Ω—Ç–∏–Ω –ø–æ–º–æ–≥–∞–µ—Ç."},
        "med2":{health:15,message:"–ò—Å—Ü–µ–ª–µ–Ω–∏–µ —Å–ø–∞—Å–∞–µ—Ç –±–æ–ª—å–Ω—ã—Ö."},
        "default":{health:-8,message:"–ë–æ–ª–µ–∑–Ω—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è..."}
      }});
    }
    if (gameState.crisisFlags.famine){
      gameState.visitorsQueue.push({ name:"–ì–æ–ª–æ–¥–∞—é—â–∏–µ", portrait:"üçû", problem:"–ì–æ–ª–æ–¥", description:"–ú–∞—Å—Å–æ–≤—ã–π <span class='problem-keyword'>–ì–æ–ª–æ–¥</span>!", solutions:{
        "res1":{food:10,message:"–•–ª–µ–± —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –≥–æ–ª–æ–¥–∞."},
        "res3":{food:15,message:"–£—Ä–æ–∂–∞–π –∫–æ—Ä–º–∏—Ç –≤—Å–µ—Ö."},
        "default":{food:-8,morale:-5,message:"–ì–æ–ª–æ–¥ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è..."}
      }});
    }
    if (gameState.crisisFlags.unrest){
      gameState.visitorsQueue.push({ name:"–ù–µ–¥–æ–≤–æ–ª—å–Ω—ã–µ", portrait:"üó£Ô∏è", problem:"–ë–µ—Å–ø–æ—Ä—è–¥–∫–∏", description:"–°—Å–æ—Ä—ã –∏ –¥—Ä–∞–∫–∏ —É—Å–∏–ª–∏–≤–∞—é—Ç—Å—è!", solutions:{
        "soc1":{safety:12,morale:8,trust:6,message:"–ú–∏—Ä–æ—Ç–≤–æ—Ä—Ü—ã —É—Å–ø–æ–∫–∞–∏–≤–∞—é—Ç —Å–ø–æ—Ä."},
        "soc2":{safety:10,trust:6,message:"–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ."},
        "default":{safety:-6,morale:-4,message:"–†—É–≥–∞–Ω—å –Ω–µ —Å–º–æ–ª–∫–∞–µ—Ç..."}
      }});
    }

    updateDayInfo();
    if (dayData.event) showDiscoveryModal(dayData.event); else showNextVisitor();
  } else {
    generateRoguelikeDay();
  }
}

function applyActState(act, dayData){
  if (!act) return;
  const firstEntry = !gameState.actsEntered.has(act.id);
  if (firstEntry){
    gameState.actsEntered.add(act.id);
    gameState.currentAct = act.id;
    gameState.lastBeat = null;
    if (act.entryText){
      addToJournal(act.entryText);
      showNotification(`${act.label}: ${act.title}`);
    } else {
      showNotification(`${act.label}: ${act.title}`);
    }
    if (act.entryModifiers) applyEffects({ ...act.entryModifiers });
  } else {
    gameState.currentAct = act.id;
  }

  const beat = getActBeat(act, gameState.day);
  const beatKey = beat ? `${act.id}:${beat}` : null;
  if (beat && gameState.lastBeat !== beatKey){
    addToJournal(`${act.label}: ${beat}`);
    gameState.lastBeat = beatKey;
  }

  if (dayData){
    if (dayData.narrative) addToJournal(dayData.narrative);
    if (dayData.modifiers){
      applyEffects({ ...dayData.modifiers });
      if (dayData.modifierText){
        addToJournal(dayData.modifierText);
        showNotification(dayData.modifierText);
      }
    } else if (dayData.modifierText){
      addToJournal(dayData.modifierText);
      showNotification(dayData.modifierText);
    }
  }
}

function applyNightDecay(){
  Object.keys(gameState.stats).forEach(stat=>{
    const decay = Math.floor(Math.random()*gameState.nightDecay)+1;
    gameState.stats[stat] = Math.max(0, gameState.stats[stat]-decay);
  });
  addToJournal(`–ù–æ—á—å –ø—Ä–æ—à–ª–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ. –ü–æ—Å–µ–ª–µ–Ω–∏–µ –æ—Å–ª–∞–±–ª–æ.`);
  updateStats();
  showNotification("–ù–æ—á–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–Ω–∏–∂–µ–Ω—ã");
}
function checkCrises(){
  if (gameState.stats.health < 40 && !gameState.crisisFlags.epidemic){ gameState.crisisFlags.epidemic = true; showNotification("‚ö†Ô∏è –≠–ü–ò–î–ï–ú–ò–Ø –Ω–∞—á–∞–ª–∞—Å—å –≤ –ø–æ—Å–µ–ª–µ–Ω–∏–∏!"); }
  if (gameState.stats.food   < 35 && !gameState.crisisFlags.famine)  { gameState.crisisFlags.famine  = true; showNotification("‚ö†Ô∏è –ì–û–õ–û–î –æ—Ö–≤–∞—Ç–∏–ª –ø–æ—Å–µ–ª–µ–Ω–∏–µ!"); }
  if (gameState.stats.safety < 35 && !gameState.crisisFlags.unrest)  { gameState.crisisFlags.unrest  = true; showNotification("‚ö†Ô∏è –ë–ï–°–ü–û–†–Ø–î–ö–ò –Ω–∞—á–∞–ª–∏—Å—å!"); }
}
function showNotification(text){
  const n=document.createElement('div'); n.className='event-notification'; n.textContent=text; document.body.appendChild(n); setTimeout(()=>n.remove(), 3000);
}

/* ===================== –†–û–ì–ê–õ–ò–ö ===================== */
function generateRoguelikeDay(){
  const count = Math.min(2 + Math.floor(gameState.day/2), 5);
  gameState.visitorsQueue = [];
  const problems = [
    { name:"–ë–æ–ª—å–Ω–æ–π", portrait:"ü§í", problem:"–ë–æ–ª–µ–∑–Ω—å", stat:"health" },
    { name:"–ì–æ–ª–æ–¥–Ω—ã–π", portrait:"üòî", problem:"–ì–æ–ª–æ–¥",   stat:"food" },
    { name:"–ò—Å–ø—É–≥–∞–Ω–Ω—ã–π", portrait:"üò∞", problem:"–°—Ç—Ä–∞—Ö", stat:"morale" },
    { name:"–†–∞–Ω–µ–Ω—ã–π", portrait:"ü©∏", problem:"–†–∞–Ω–∞",     stat:"health" },
    { name:"–°–ø–æ—Ä—â–∏–∫", portrait:"üò§", problem:"–°–ø–æ—Ä",     stat:"safety" }
  ];
  for (let i=0;i<count;i++){
    const p = problems[Math.floor(Math.random()*problems.length)];
    gameState.visitorsQueue.push({
      ...p, description:`–ü—Ä–æ–±–ª–µ–º–∞: <span class='problem-keyword'>${p.problem}</span>`, solutions: generateRoguelikeSolutions(p.stat)
    });
  }
  updateDayInfo(); showNextVisitor();
}
function generateRoguelikeSolutions(mainStat){
  const solutions = {};
  const availableWords = [...wordsDatabase, ...gameState.discoveredWords].filter(w=>!gameState.usedWords.has(w.id));
  const picks = availableWords.slice(0, Math.min(5, availableWords.length));
  picks.forEach(word=>{
    const eff = {};
    if (word.category==='medicine' && mainStat==='health') eff.health = 10 + Math.floor(Math.random()*8);
    else if (word.category==='resource' && mainStat==='food') eff.food = 10 + Math.floor(Math.random()*8);
    else if (word.category==='social' && mainStat==='safety') eff.safety = 10 + Math.floor(Math.random()*8);
    else if (word.category==='emotion' && mainStat==='morale') eff.morale = 10 + Math.floor(Math.random()*8);
    else eff[mainStat] = 3 + Math.floor(Math.random()*5);
    eff.message = "–°–ª–æ–≤–æ –ø–æ–º–æ–≥–∞–µ—Ç.";
    solutions[word.id] = eff;
  });
  solutions.default = { [mainStat]: -5 - Math.floor(Math.random()*5), message:"–ü—Ä–æ–±–ª–µ–º–∞ —É—Å—É–≥—É–±–ª—è–µ—Ç—Å—è..." };
  return solutions;
}

/* ===================== UI: –î–ï–ù–¨ / –ü–û–°–ï–¢–ò–¢–ï–õ–ò ===================== */
function updateDayInfo(){
  document.getElementById('day-number').textContent = gameState.day;
  if (gameState.mode==='roguelike'){
    document.getElementById('day-description').textContent = `–°—á—ë—Ç: ${gameState.roguelikeScore}`;
  } else {
    const dayData = campaignEvents[gameState.day];
    const act = getActForDay(gameState.day);
    const beat = act ? getActBeat(act, gameState.day) : '';
    const base = dayData?.headline || beat || (act ? act.title : '–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...');
    const desc = act ? `${act.label} ‚Äî ${base}` : base;
    document.getElementById('day-description').textContent = desc;
  }
}
function updateStats(){
  Object.keys(gameState.stats).forEach(stat=>{
    const value = gameState.stats[stat];
    document.getElementById(`${stat}-value`).textContent = value;
    const el = document.querySelector(`[data-stat="${stat}"]`);
    el.querySelector('.stat-fill').style.width = `${value}%`;
    if (value<=10){ el.classList.add('critical'); el.classList.add('warning'); }
    else if (value<=25){ el.classList.remove('critical'); el.classList.add('warning'); }
    else { el.classList.remove('critical'); el.classList.remove('warning'); }
    if (value<=0 && !gameState.ended){ gameOver(stat); }
  });
}
function updateWordCount(){
  const total = wordsDatabase.length + gameState.discoveredWords.length;
  const available = total - gameState.usedWords.size;
  document.getElementById('word-count').textContent = `–î–æ—Å—Ç—É–ø–Ω–æ: ${available} –∏–∑ ${total}`;
  document.getElementById('neo-count').textContent = gameState.canCreateNeologism;
}

function showNextVisitor(){
  updateQueueIndicator();
  if (gameState.visitorsQueue.length===0){ endDay(); return; }
  const v = gameState.visitorsQueue.shift();
  gameState.currentVisitor = v;

  const box = document.getElementById('visitor-content');
  box.innerHTML = `
    <div class="visitor">
      <div class="visitor-portrait" id="visitor-portrait" onclick="selectVisitor()">${v.portrait}</div>
      <div class="visitor-name">${v.name}</div>
      <div class="visitor-problem">${v.description}</div>
    </div>
  `;

  const portrait = document.getElementById('visitor-portrait');
  portrait.addEventListener('dragover', e=>{ e.preventDefault(); portrait.classList.add('selected'); });
  portrait.addEventListener('drop', e=>{
    e.preventDefault();
    const wordId = e.dataTransfer.getData('text/plain');
    const word = [...wordsDatabase, ...gameState.discoveredWords].find(w=>w.id===wordId);
    if (word && !gameState.usedWords.has(wordId)){
      gameState.selectedWord = word; portrait.classList.add('selected'); giveWord();
    }
  });
  checkCanGiveWord();
}
function selectVisitor(){ document.getElementById('visitor-portrait').classList.add('selected'); checkCanGiveWord(); }
function updateQueueIndicator(){
  const q=document.getElementById('visitors-queue'); q.innerHTML='';
  const total = gameState.visitorsQueue.length + (gameState.currentVisitor?1:0);
  for (let i=0;i<total;i++){ const d=document.createElement('div'); d.className='queue-indicator'; if (i===0 && gameState.currentVisitor) d.classList.add('active'); q.appendChild(d); }
}

/* ===================== UI: –°–õ–û–í–ê ===================== */
function renderCategories(){
  const c=document.getElementById('word-categories'); c.innerHTML='';
  CATEGORIES.forEach(cat=>{
    const tab=document.createElement('div'); tab.className='category-tab'; if (cat==='all') tab.classList.add('active');
    tab.dataset.category = cat; tab.textContent = CATEGORY_NAMES[cat]; tab.onclick = ()=>filterByCategory(cat);
    if (cat!=='all'){ const count=getAvailableWordsInCategory(cat); if (count>0){ const b=document.createElement('span'); b.className='category-count'; b.textContent=count; tab.appendChild(b);} }
    c.appendChild(tab);
  });
}
function getAvailableWordsInCategory(category){
  const all=[...wordsDatabase, ...gameState.discoveredWords];
  return all.filter(w=>w.category===category && !gameState.usedWords.has(w.id)).length;
}
function filterByCategory(category){
  document.querySelectorAll('.category-tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`[data-category="${category}"]`).classList.add('active');
  renderWords(category);
}
function renderWords(category='all', search=''){
  const container = document.getElementById('words-container');
  const s = (search || document.getElementById('word-search').value || '').toLowerCase();
  let words = [...wordsDatabase, ...gameState.discoveredWords];
  if (category!=='all') words = words.filter(w=>w.category===category);
  if (s) words = words.filter(w=>w.text.toLowerCase().includes(s));
  container.innerHTML = '';
  words.forEach(word=>{
    const el=document.createElement('div'); el.className='word'; el.textContent=word.text; el.dataset.id=word.id;
    if (gameState.discoveredWords.includes(word)) el.classList.add('neologism');
    if (word.tooltip){ const tip=document.createElement('div'); tip.className='word-tooltip'; tip.textContent=word.tooltip; el.appendChild(tip); }
    if (gameState.usedWords.has(word.id)) el.classList.add('used');
    else {
      el.onclick = ()=>selectWord(word);
      el.draggable = true;
      el.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', word.id); });
    }
    container.appendChild(el);
  });
}
function selectWord(word){
  if (gameState.usedWords.has(word.id)) return;
  document.querySelectorAll('.word').forEach(w=>w.classList.remove('selected'));
  document.querySelector(`.word[data-id="${word.id}"]`)?.classList.add('selected');
  gameState.selectedWord = word; checkCanGiveWord();
}
function checkCanGiveWord(){
  const hasVisitor = !!document.getElementById('visitor-portrait')?.classList.contains('selected');
  const hasWord = !!gameState.selectedWord;
  document.getElementById('give-word-btn').disabled = !(hasVisitor && hasWord);
}

/* ===================== –í–´–î–ê–ß–ê –°–õ–û–í–ê ===================== */
function giveWord(){
  if (!gameState.selectedWord || !gameState.currentVisitor) return;
  const word = gameState.selectedWord;
  const visitor = gameState.currentVisitor;

  createWordEffect(word.text);
  gameState.usedWords.add(word.id);
  gameState.wordsUsedToday.push(word.text);

  const result = (visitor.solutions && (visitor.solutions[word.id] || visitor.solutions.default)) || { health:-3, message:"–°–ª–æ–≤–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç..." };
  applyEffects(result);
  showResult(word.text, result.message, result);
  addToJournal(`–î–µ–Ω—å ${gameState.day}: "${word.text}" ‚Üí ${visitor.name}`);

  if (gameState.mode==='roguelike'){
    const positives = Object.keys(result).filter(k=>k!=='message' && result[k]>0).length;
    gameState.roguelikeScore += positives * 10;
  }

  gameState.selectedWord = null; gameState.currentVisitor = null;
  document.getElementById('give-word-btn').disabled = true;
  renderCategories(); renderWords(); updateWordCount();

  setTimeout(()=>showNextVisitor(), 2000);
}
function createWordEffect(text){
  const d=document.createElement('div'); d.className='word-effect'; d.textContent=text; document.body.appendChild(d); setTimeout(()=>d.remove(), 3000);
}
function applyEffects(result){
  Object.keys(gameState.stats).forEach(stat=>{
    if (result[stat]) gameState.stats[stat] = Math.max(0, Math.min(100, gameState.stats[stat] + result[stat]));
  });
  updateStats();
}
function showResult(word, message, effects){
  const div=document.createElement('div'); div.className='result-message';
  const em = {health:'‚ù§Ô∏è', food:'üåæ', safety:'üõ°Ô∏è', morale:'üíö', trust:'ü§ù'};
  let statsHtml = '<div class="stat-changes">';
  Object.keys(effects).forEach(k=>{
    if (k==='message' || !effects[k]) return;
    const cls = effects[k]>0 ? 'positive' : 'negative';
    statsHtml += `<span class="stat-change ${cls}">${em[k]||''} ${effects[k]>0?'+':''}${effects[k]}</span>`;
  });
  statsHtml += '</div>';
  div.innerHTML = `<h3>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: "${word}"</h3><p>${message||''}</p>${statsHtml}`;
  document.body.appendChild(div);
  setTimeout(()=>div.remove(), 2500);
}

/* ===================== –î–ù–ï–í–ù–ò–ö / –ú–û–î–ê–õ–ö–ò ===================== */
function addToJournal(text){
  gameState.journal.push(text);
  const cont=document.getElementById('journal-content');
  const e=document.createElement('div'); e.className='journal-entry'; e.textContent=text; cont.appendChild(e); cont.scrollTop = cont.scrollHeight;
}
function closeModal(){ document.querySelector('.modal')?.remove(); }

/* ===================== DISCOVERY (–Ω–∞—Ö–æ–¥–∫–∏) ===================== */
let selectedDiscoveries = [];
function showDiscoveryModal(event){
  selectedDiscoveries = [];
  const modal=document.createElement('div'); modal.className='modal';
  modal.innerHTML = `
    <div class="modal-content">
      <h3>${event.title}</h3>
      <p>${event.description}</p>
      <div class="word-selector">
        ${event.words.map(w=>`<div class="word-option" onclick="selectDiscoveredWord(this,'${w}')">${w}</div>`).join('')}
      </div>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ <b>${event.choose}</b> —Å–ª–æ–≤(–∞)</p>
      <div class="action-buttons" style="margin-top:10px">
        <button class="action-button" onclick="confirmDiscovery(${event.choose})">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button class="action-button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>`;
  document.body.appendChild(modal);
}
function selectDiscoveredWord(el, word){
  const i = selectedDiscoveries.indexOf(word);
  if (i>-1){ selectedDiscoveries.splice(i,1); el.classList.remove('selected'); }
  else {
    el.classList.add('selected');
    selectedDiscoveries.push(word);
  }
}
function confirmDiscovery(maxCount){
  if (selectedDiscoveries.length !== maxCount){ alert(`–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–æ–≤–Ω–æ ${maxCount} —Å–ª–æ–≤(–∞)`); return; }
  selectedDiscoveries.forEach(word=>{
    const newWord = { text:word, category:'abstract', id:'disc_'+Date.now()+'_'+word, tooltip:'–ù–∞–π–¥–µ–Ω–Ω–æ–µ —Å–ª–æ–≤–æ' };
    gameState.discoveredWords.push(newWord);
    addToJournal(`–ù–∞–π–¥–µ–Ω–æ —Å–ª–æ–≤–æ: "${word}"`);
  });
  closeModal();
  renderWords(); updateWordCount(); showNextVisitor();
}

/* ===================== –ù–ï–û–õ–û–ì–ò–ó–ú–´ ===================== */
let neoSelected = [];
function openNeologismModal(){
  if (gameState.canCreateNeologism<=0){ showResult('','–í—ã –∏—Å—á–µ—Ä–ø–∞–ª–∏ —Å–∏–ª—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–≤',{ }); return; }
  neoSelected = [];
  const available = [...wordsDatabase, ...gameState.discoveredWords].filter(w=>!gameState.usedWords.has(w.id));
  const modal=document.createElement('div'); modal.className='modal';
  modal.innerHTML = `
    <div class="modal-content">
      <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–ª–æ–≥–∏–∑–º–∞</h3>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ <b>2‚Äì3</b> —Å–ª–æ–≤–∞-–æ—Å–Ω–æ–≤—ã, –∑–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</p>
      <div class="word-selector">
        ${available.map(w=>`<div class="word-option" onclick="toggleNeoWord(this,'${w.id}')">${w.text}</div>`).join('')}
      </div>
      <input type="text" class="word-search" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞..." id="neo-name" style="margin-top:10px;">
      <div class="action-buttons" style="margin-top:10px">
        <button class="action-button" onclick="createNeologism()">–°–æ–∑–¥–∞—Ç—å</button>
        <button class="action-button" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>`;
  document.body.appendChild(modal);
}
function toggleNeoWord(el, id){
  const pool = [...wordsDatabase, ...gameState.discoveredWords];
  const w = pool.find(x=>x.id===id);
  const i = neoSelected.findIndex(x=>x.id===id);
  if (i>-1){ neoSelected.splice(i,1); el.classList.remove('selected'); }
  else { if (neoSelected.length>=3) return; neoSelected.push(w); el.classList.add('selected'); }
}
function createNeologism(){
  const name = document.getElementById('neo-name').value.trim();
  if (!name){ alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞'); return; }
  if (neoSelected.length<2){ alert('–í—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–ª–æ–≤–∞-–æ—Å–Ω–æ–≤—ã'); return; }

  // —Å–∂–µ—á—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∏
  neoSelected.forEach(w=> gameState.usedWords.add(w.id));
  // —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
  const tooltip = `–°–æ–∑–¥–∞–Ω–æ –∏–∑: ${neoSelected.map(w=>w.text).join(' + ')}`;
  const newWord = { text:name, category:'abstract', id:'neo_'+Date.now(), tooltip };
  gameState.discoveredWords.push(newWord);
  gameState.canCreateNeologism--;

  closeModal();
  addToJournal(`–°–æ–∑–¥–∞–Ω –Ω–µ–æ–ª–æ–≥–∏–∑–º: "${name}" (${tooltip})`);
  renderCategories(); renderWords(); updateWordCount();
  showResult(name, `–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ ¬´${name}¬ª –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–Ω–∏–≥—É!`, { trust:5 });
}

/* ===================== –ö–û–ù–ï–¶ –î–ù–Ø / –ö–û–ù–¶–û–í–ö–ò ===================== */
function endDay(){
  // —Å–≤–æ–¥–∫–∞
  const delta = {};
  Object.keys(gameState.stats).forEach(k=> delta[k] = (gameState.stats[k]||0) - (gameState.snapshot[k]||0));
  const em = {health:'‚ù§Ô∏è', food:'üåæ', safety:'üõ°Ô∏è', morale:'üíö', trust:'ü§ù'};
  const parts = Object.keys(delta).map(k=> delta[k] ? `${em[k]} ${delta[k]>0?'+':''}${delta[k]}` : '').filter(Boolean);
  const vc = document.getElementById('visitor-content');
  vc.innerHTML = `
    <div style="text-align:center; padding:18px;">
      <h3 style="color:var(--gold); margin-bottom:10px;">–î–µ–Ω—å ${gameState.day} –∑–∞–≤–µ—Ä—à—ë–Ω</h3>
      <p>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–ª–æ–≤: ${gameState.wordsUsedToday.length}${gameState.wordsUsedToday.length? ' ‚Äî ' + gameState.wordsUsedToday.join(', ') : ''}</p>
      <p style="margin-top:8px;">–ò–∑–º–µ–Ω–µ–Ω–∏—è: ${parts.join(' ‚Ä¢ ') || '‚Äî'}</p>
      ${gameState.mode==='roguelike' ? `<p style="margin-top:6px;">–°—á—ë—Ç: ${gameState.roguelikeScore}</p>` : ''}
    </div>`;
  const nextBtn = document.getElementById('next-day-btn');
  const finale = gameState.mode==='campaign' ? campaignEvents[gameState.day]?.finale : null;
  if (finale){
    nextBtn.style.display='none';
    localStorage.removeItem('librarian_save');
    setTimeout(()=>resolveCampaignEnding(finale), 1200);
  } else {
    nextBtn.style.display='block';
    saveGame();
  }
}
function nextDay(){
  document.getElementById('next-day-btn').style.display='none';
  gameState.day++;
  if (gameState.mode==='roguelike'){
    // –º–∞–ª–µ–Ω—å–∫–æ–µ –¥—Ä–µ–π—Ñ–æ–≤–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ
    Object.keys(gameState.stats).forEach(k=> gameState.stats[k] = Math.max(0, gameState.stats[k] - Math.floor(Math.random()*4)));
    updateStats();
  }
  startDay();
}
function gameOver(failedStat){
  if (gameState.ended) return; gameState.ended=true;
  const text = { health:"–≠–ø–∏–¥–µ–º–∏—è —É–Ω–∏—á—Ç–æ–∂–∏–ª–∞ –ø–æ—Å–µ–ª–µ–Ω–∏–µ‚Ä¶", food:"–ì–æ–ª–æ–¥ –ø–æ–≥—É–±–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤—ã–∂–∏–≤—à–∏—Ö‚Ä¶", safety:"–•–∞–æ—Å —Ä–∞–∑—Ä—É—à–∏–ª –æ–±—â–∏–Ω—É‚Ä¶", morale:"–õ—é–¥–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ –≤–æ–ª—é –∫ –∂–∏–∑–Ω–∏‚Ä¶", trust:"–ñ–∏—Ç–µ–ª–∏ –∏–∑–≥–Ω–∞–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è‚Ä¶" }[failedStat] || '–ü—Ä–æ–≤–∞–ª‚Ä¶';
  const d=document.createElement('div'); d.className='game-over';
  d.innerHTML = `
    <div class="game-over-content">
      <h1 class="defeat">–ö–û–ù–ï–¶</h1>
      <p style="font-size:1.2em; margin-bottom:16px;">${text}</p>
      <p>–ü—Ä–æ–∂–∏—Ç–æ –¥–Ω–µ–π: ${gameState.day}</p>
      <p>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–ª–æ–≤: ${gameState.usedWords.size}</p>
      ${gameState.mode==='roguelike' ? `<p>–°—á—ë—Ç: ${gameState.roguelikeScore}</p>` : ''}
      <div class="action-buttons" style="margin-top:14px;">
        <button class="action-button" onclick="location.reload()">–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>
      </div>
    </div>`;
  document.body.appendChild(d);
}
function resolveCampaignEnding(config){
  if (gameState.ended) return;
  const remaining = wordsDatabase.length + gameState.discoveredWords.length - gameState.usedWords.size;
  const stats = gameState.stats;
  const values = Object.values(stats);
  const minStat = values.length ? Math.min(...values) : 0;
  const avgStat = values.length ? Math.round(values.reduce((a,b)=>a+b,0)/values.length) : 0;
  const state = { remaining, stats, minStat, avgStat, wordsUsed: gameState.usedWords.size };
  let ending = null;
  if (config && Array.isArray(config.endings)){
    ending = config.endings.find(end=> typeof end.condition==='function' && end.condition(state));
  }
  if (!ending) ending = config?.default || { className:'neutral', title:'–ö–æ–Ω–µ—Ü –∏—Å—Ç–æ—Ä–∏–∏', message:'–ü–æ—Å–µ–ª–µ–Ω–∏–µ –∑–∞—Ç–∏—Ö–∞–µ—Ç –ø–æ–¥ —Å–ª–æ–µ–º –ø–µ–ø–ª–∞.' };
  showCampaignEnding(ending, state);
}

function showCampaignEnding(ending, state){
  if (gameState.ended) return;
  gameState.ended = true;
  localStorage.removeItem('librarian_save');
  const message = typeof ending.message === 'function' ? ending.message(state) : ending.message;
  const cls = ending.className || 'neutral';
  const statIcons = { health:'‚ù§Ô∏è', food:'üåæ', safety:'üõ°Ô∏è', morale:'üíö', trust:'ü§ù' };
  const statsSummary = Object.keys(statIcons).map(k=> `${statIcons[k]} ${gameState.stats[k]||0}`).join(' ‚Ä¢ ');
  const d=document.createElement('div'); d.className='game-over';
  d.innerHTML = `
    <div class="game-over-content">
      <h1 class="${cls}">${ending.title || '–§–ò–ù–ê–õ'}</h1>
      <p style="font-size:1.2em; margin-bottom:16px;">${message || ''}</p>
      <p>–ü—Ä–æ–π–¥–µ–Ω–æ –¥–Ω–µ–π: ${gameState.day}</p>
      <p>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–ª–æ–≤: ${state.remaining}</p>
      <p>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–ª–æ–≤: ${state.wordsUsed}</p>
      <p>–°—Ä–µ–¥–Ω–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: ${state.avgStat}</p>
      <p>${statsSummary}</p>
      <div class="action-buttons" style="margin-top:14px;">
        <button class="action-button" onclick="location.reload()">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
      </div>
    </div>`;
  document.body.appendChild(d);
}

function victory(){
  const remaining = wordsDatabase.length + gameState.discoveredWords.length - gameState.usedWords.size;
  let cls='neutral', msg='–ü–æ—Å–µ–ª–µ–Ω–∏–µ –≤—ã–∂–∏–ª–æ‚Ä¶';
  if (remaining>30) { cls='victory'; msg='–í—ã —Å–ø–∞—Å–ª–∏ –ª—é–¥–µ–π –∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —è–∑—ã–∫!'; }
  else if (remaining<10){ cls='defeat'; msg='–í—ã–∂–∏–ª–∏, –Ω–æ —è–∑—ã–∫ –ø–æ—á—Ç–∏ —É—Ç—Ä–∞—á–µ–Ω‚Ä¶'; }
  const d=document.createElement('div'); d.className='game-over';
  d.innerHTML = `
    <div class="game-over-content">
      <h1 class="${cls}">${cls==='victory'?'–ü–û–ë–ï–î–ê!':'–ö–û–ù–ï–¶ –ò–°–¢–û–†–ò–ò'}</h1>
      <p style="font-size:1.2em; margin-bottom:16px;">${msg}</p>
      <p>–ü—Ä–æ–π–¥–µ–Ω–æ –¥–Ω–µ–π: ${gameState.day}</p>
      <p>–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —Å–ª–æ–≤: ${remaining}</p>
      <div class="action-buttons" style="margin-top:14px;">
        <button class="action-button" onclick="location.reload()">–ù–û–í–ê–Ø –ò–ì–†–ê</button>
      </div>
    </div>`;
  document.body.appendChild(d);
}
</script>
</body>
</html>
